<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SAP UI5 Validation Test</title>
    <script id="sap-ui-bootstrap"
        src="https://ui5.sap.com/1.120.0/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m,sap.ui.core"
        data-sap-ui-async="true"
        data-sap-ui-onInit="runValidation">
    </script>
    
    <script>
        function runValidation() {
            sap.ui.require([
                "sap/ui/core/Component",
                "sap/ui/core/ComponentContainer",
                "sap/m/MessageBox"
            ], function(Component, ComponentContainer, MessageBox) {
                
                const validationResults = {
                    passed: [],
                    failed: []
                };
                
                // Test 1: Load manifest
                jQuery.ajax({
                    url: "/app/a2a-fiori/manifest.json",
                    dataType: "json",
                    success: function(manifest) {
                        // Validate manifest structure
                        if (manifest["sap.app"] && manifest["sap.app"].id === "a2a.network.fiori") {
                            validationResults.passed.push("Manifest ID correct");
                        } else {
                            validationResults.failed.push("Manifest ID incorrect");
                        }
                        
                        if (manifest["sap.ui5"] && manifest["sap.ui5"].dependencies) {
                            validationResults.passed.push("UI5 dependencies defined");
                        } else {
                            validationResults.failed.push("UI5 dependencies missing");
                        }
                        
                        if (manifest["sap.fiori"] && manifest["sap.fiori"].registrationIds) {
                            validationResults.passed.push("Fiori registration present");
                        } else {
                            validationResults.failed.push("Fiori registration missing");
                        }
                        
                        // Test 2: Load Component
                        Component.create({
                            name: "a2a.network.fiori",
                            manifest: true,
                            async: true
                        }).then(function(oComponent) {
                            validationResults.passed.push("Component loaded successfully");
                            
                            // Test 3: Check Component methods
                            if (typeof oComponent.getContentDensityClass === "function") {
                                validationResults.passed.push("Content density method exists");
                            } else {
                                validationResults.failed.push("Content density method missing");
                            }
                            
                            if (oComponent.getRouter && oComponent.getRouter()) {
                                validationResults.passed.push("Router initialized");
                            } else {
                                validationResults.failed.push("Router not initialized");
                            }
                            
                            // Test 4: Check models
                            if (oComponent.getModel()) {
                                validationResults.passed.push("Default model exists");
                            }
                            
                            if (oComponent.getModel("i18n")) {
                                validationResults.passed.push("i18n model exists");
                            } else {
                                validationResults.failed.push("i18n model missing");
                            }
                            
                            // Display results
                            displayResults(validationResults);
                            
                        }).catch(function(error) {
                            validationResults.failed.push("Component loading failed: " + error);
                            displayResults(validationResults);
                        });
                        
                    },
                    error: function(xhr, status, error) {
                        validationResults.failed.push("Manifest loading failed: " + error);
                        displayResults(validationResults);
                    }
                });
                
                function displayResults(results) {
                    const totalTests = results.passed.length + results.failed.length;
                    const passRate = Math.round((results.passed.length / totalTests) * 100);
                    
                    let message = `SAP UI5 Validation Results:\n\n`;
                    message += `Total Tests: ${totalTests}\n`;
                    message += `Passed: ${results.passed.length}\n`;
                    message += `Failed: ${results.failed.length}\n`;
                    message += `Pass Rate: ${passRate}%\n\n`;
                    
                    if (results.passed.length > 0) {
                        message += "Passed Tests:\n";
                        results.passed.forEach(test => {
                            message += `✓ ${test}\n`;
                        });
                    }
                    
                    if (results.failed.length > 0) {
                        message += "\nFailed Tests:\n";
                        results.failed.forEach(test => {
                            message += `✗ ${test}\n`;
                        });
                    }
                    
                    if (passRate === 100) {
                        message += "\n✓ All SAP UI5 standards validated successfully!";
                        MessageBox.success(message);
                    } else {
                        MessageBox.warning(message);
                    }
                    
                    // Also log to console
                    console.log(message);
                }
            });
        }
    </script>
</head>
<body class="sapUiBody">
    <div id="content"></div>
</body>
</html>