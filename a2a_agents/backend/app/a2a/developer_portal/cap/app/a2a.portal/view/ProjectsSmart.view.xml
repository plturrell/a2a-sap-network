<mvc:View
    controllerName="com.sap.a2a.developerportal.controller.ProjectsSmart"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout">
    
    <Page title="Projects - Smart Controls" showNavButton="false">
        <content>
            <VBox class="sapUiMediumMargin">
                
                <!-- Smart Filter Bar -->
                <smartFilterBar:SmartFilterBar
                    id="smartFilterBar"
                    entitySet="Projects"
                    persistencyKey="ProjectsFilterVariant"
                    useToolbar="false"
                    showRestoreButton="true"
                    showClearButton="true"
                    showGoButton="true"
                    search="onSearch"
                    filterChange="onFilterChange"
                    class="sapUiResponsiveMargin">
                    
                    <!-- Custom Filter Fields -->
                    <smartFilterBar:controlConfiguration>
                        <smartFilterBar:ControlConfiguration
                            key="status"
                            visibleInAdvancedArea="true"
                            preventInitialDataFetchInValueHelpDialog="false">
                        </smartFilterBar:ControlConfiguration>
                        
                        <smartFilterBar:ControlConfiguration
                            key="type"
                            visibleInAdvancedArea="true"
                            preventInitialDataFetchInValueHelpDialog="false">
                        </smartFilterBar:ControlConfiguration>
                        
                        <smartFilterBar:ControlConfiguration
                            key="created_date"
                            visibleInAdvancedArea="true"
                            filterType="interval">
                        </smartFilterBar:ControlConfiguration>
                    </smartFilterBar:controlConfiguration>
                    
                </smartFilterBar:SmartFilterBar>
                
                <!-- Smart Table -->
                <smartTable:SmartTable
                    id="smartTable"
                    entitySet="Projects"
                    smartFilterId="smartFilterBar"
                    tableType="ResponsiveTable"
                    useExportToExcel="true"
                    useVariantManagement="true"
                    useTablePersonalisation="true"
                    header="Projects ({items>/length})"
                    showRowCount="true"
                    persistencyKey="ProjectsTableVariant"
                    enableAutoBinding="true"
                    class="sapUiResponsiveMargin"
                    beforeRebindTable="onBeforeRebindTable"
                    initialise="onSmartTableInitialised">
                    
                    <!-- Custom Toolbar -->
                    <smartTable:customToolbar>
                        <OverflowToolbar design="Transparent">
                            <Title text="Projects" level="H2"/>
                            <ToolbarSpacer/>
                            <Button 
                                text="Create Project" 
                                type="Emphasized" 
                                icon="sap-icon://add"
                                press="onCreateProject"/>
                            <Button 
                                text="Import Project" 
                                icon="sap-icon://upload"
                                press="onImportProject"/>
                            <Button 
                                text="Export Selected" 
                                icon="sap-icon://download"
                                press="onExportSelected"/>
                            <ToolbarSeparator/>
                            <Button 
                                text="Refresh" 
                                icon="sap-icon://refresh"
                                press="onRefresh"/>
                        </OverflowToolbar>
                    </smartTable:customToolbar>
                    
                    <!-- Table Definition -->
                    <Table 
                        id="projectsTable"
                        items="{path: '/projects', sorter: {path: 'updated_at', descending: true}}"
                        mode="MultiSelect"
                        growing="true"
                        growingThreshold="50"
                        growingScrollToLoad="true"
                        sticky="ColumnHeaders,HeaderToolbar">
                        
                        <headerToolbar>
                            <OverflowToolbar>
                                <Label text="Projects ({items>/length})"/>
                                <ToolbarSpacer/>
                                <SearchField 
                                    width="20rem" 
                                    search="onQuickSearch"
                                    placeholder="Quick search..."/>
                            </OverflowToolbar>
                        </headerToolbar>
                        
                        <columns>
                            <Column 
                                width="12rem"
                                sortProperty="name"
                                filterProperty="name">
                                <Text text="Project Name"/>
                            </Column>
                            
                            <Column 
                                width="8rem"
                                sortProperty="status"
                                filterProperty="status">
                                <Text text="Status"/>
                            </Column>
                            
                            <Column 
                                width="8rem"
                                sortProperty="type"
                                filterProperty="type">
                                <Text text="Type"/>
                            </Column>
                            
                            <Column 
                                width="10rem"
                                sortProperty="created_date"
                                filterProperty="created_date">
                                <Text text="Created"/>
                            </Column>
                            
                            <Column 
                                width="10rem"
                                sortProperty="updated_at"
                                filterProperty="updated_at">
                                <Text text="Last Modified"/>
                            </Column>
                            
                            <Column 
                                width="8rem"
                                sortProperty="agents_count"
                                filterProperty="agents_count">
                                <Text text="Agents"/>
                            </Column>
                            
                            <Column 
                                width="8rem"
                                sortProperty="deployment_status"
                                filterProperty="deployment_status">
                                <Text text="Deployment"/>
                            </Column>
                            
                            <Column width="10rem">
                                <Text text="Actions"/>
                            </Column>
                        </columns>
                        
                        <items>
                            <ColumnListItem press="onProjectPress">
                                <cells>
                                    <!-- Project Name with Icon -->
                                    <HBox alignItems="Center" class="sapUiTinyMargin">
                                        <core:Icon 
                                            src="sap-icon://folder" 
                                            class="sapUiTinyMarginEnd"
                                            color="{path: 'status', formatter: '.formatStatusColor'}"/>
                                        <VBox>
                                            <Link 
                                                text="{name}" 
                                                press="onProjectPress"
                                                emphasized="true"/>
                                            <Text 
                                                text="{description}" 
                                                class="sapUiTinyText"
                                                maxLines="1"/>
                                        </VBox>
                                    </HBox>
                                    
                                    <!-- Status -->
                                    <ObjectStatus 
                                        text="{status}" 
                                        state="{path: 'status', formatter: '.formatStatusState'}"
                                        icon="{path: 'status', formatter: '.formatStatusIcon'}"/>
                                    
                                    <!-- Type -->
                                    <Text text="{type}"/>
                                    
                                    <!-- Created Date -->
                                    <Text text="{path: 'created_date', formatter: '.formatDate'}"/>
                                    
                                    <!-- Last Modified -->
                                    <Text text="{path: 'updated_at', formatter: '.formatRelativeTime'}"/>
                                    
                                    <!-- Agents Count -->
                                    <ObjectNumber 
                                        number="{agents_count}" 
                                        unit="agents"
                                        state="{path: 'agents_count', formatter: '.formatAgentsState'}"/>
                                    
                                    <!-- Deployment Status -->
                                    <ObjectStatus 
                                        text="{deployment_status}" 
                                        state="{path: 'deployment_status', formatter: '.formatDeploymentState'}"
                                        icon="{path: 'deployment_status', formatter: '.formatDeploymentIcon'}"/>
                                    
                                    <!-- Actions -->
                                    <HBox>
                                        <Button 
                                            icon="sap-icon://edit" 
                                            type="Transparent"
                                            tooltip="Edit Project"
                                            press="onEditProject"/>
                                        <Button 
                                            icon="sap-icon://play" 
                                            type="Transparent"
                                            tooltip="Deploy Project"
                                            press="onDeployProject"
                                            enabled="{path: 'status', formatter: '.formatDeployEnabled'}"/>
                                        <Button 
                                            icon="sap-icon://action" 
                                            type="Transparent"
                                            tooltip="More Actions"
                                            press="onMoreActions"/>
                                    </HBox>
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                    
                </smartTable:SmartTable>
                
                <!-- Project Statistics Cards -->
                <f:GridContainer class="sapUiMediumMarginTop">
                    <f:GridContainerSettings rowSize="5rem" columnSize="5rem" gap="1rem"/>
                    
                    <!-- Active Projects Card -->
                    <GenericTile 
                        class="sapUiTinyMargin"
                        header="Active Projects"
                        subheader="Currently in development"
                        press="onFilterByStatus"
                        data:status="active"
                        xmlns:data="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1">
                        <tileContent>
                            <TileContent>
                                <content>
                                    <NumericContent 
                                        value="{/statistics/active_projects}" 
                                        indicator="Up"
                                        state="Good"/>
                                </content>
                            </TileContent>
                        </tileContent>
                    </GenericTile>
                    
                    <!-- Deployed Projects Card -->
                    <GenericTile 
                        class="sapUiTinyMargin"
                        header="Deployed Projects"
                        subheader="Live in production"
                        press="onFilterByStatus"
                        data:status="deployed">
                        <tileContent>
                            <TileContent>
                                <content>
                                    <NumericContent 
                                        value="{/statistics/deployed_projects}" 
                                        state="Good"/>
                                </content>
                            </TileContent>
                        </tileContent>
                    </GenericTile>
                    
                    <!-- Total Agents Card -->
                    <GenericTile 
                        class="sapUiTinyMargin"
                        header="Total Agents"
                        subheader="Across all projects"
                        press="onShowAgentsOverview">
                        <tileContent>
                            <TileContent>
                                <content>
                                    <NumericContent 
                                        value="{/statistics/total_agents}" 
                                        state="Neutral"/>
                                </content>
                            </TileContent>
                        </tileContent>
                    </GenericTile>
                    
                    <!-- Performance Card -->
                    <GenericTile 
                        class="sapUiTinyMargin"
                        header="Avg Performance"
                        subheader="Success rate"
                        press="onShowPerformanceDetails">
                        <tileContent>
                            <TileContent>
                                <content>
                                    <NumericContent 
                                        value="{/statistics/avg_performance}" 
                                        valueColor="Good"
                                        indicator="Up"/>
                                </content>
                            </TileContent>
                        </tileContent>
                    </GenericTile>
                </f:GridContainer>
                
            </VBox>
        </content>
    </Page>
</mvc:View>
