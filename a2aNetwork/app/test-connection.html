<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üîó Server Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîó A2A Network Launchpad - Connection Test</h1>
    
    <div id="tests"></div>
    
    <h2>üß™ Test Actions:</h2>
    <button onclick="testHealth()">Test Health Endpoint</button>
    <button onclick="testTileData()">Test Tile Data</button>
    <button onclick="openLaunchpad()">Open SAP Fiori Launchpad</button>
    <button onclick="testAllEndpoints()">Test All Endpoints</button>
    
    <div id="results"></div>

    <script>
        const baseUrl = 'http://localhost:4004';
        const testsDiv = document.getElementById('tests');
        const resultsDiv = document.getElementById('results');
        
        function addTest(name, status, message, data = null) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <strong>${name}:</strong> ${message}
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            testsDiv.appendChild(div);
        }
        
        // Test basic connectivity on load
        window.onload = function() {
            addTest('Page Load', 'success', 'Test page loaded successfully');
            testBasicConnectivity();
        };
        
        function testBasicConnectivity() {
            fetch(`${baseUrl}/health`)
                .then(response => {
                    if (response.ok) {
                        addTest('Server Connection', 'success', `‚úÖ Server is running on port 4004`);
                        return response.json();
                    } else {
                        addTest('Server Connection', 'error', `‚ùå Server responded with ${response.status}`);
                    }
                })
                .then(data => {
                    if (data) {
                        addTest('Health Check', 'success', '‚úÖ Health endpoint working', data);
                    }
                })
                .catch(error => {
                    addTest('Server Connection', 'error', `‚ùå Cannot connect to server: ${error.message}`);
                    addTest('Connection Issue', 'info', `
                        Possible solutions:
                        1. Ensure server is running: node production-launchpad-server.js
                        2. Check port 4004 is not blocked
                        3. Try running from same directory as server
                    `);
                });
        }
        
        function testHealth() {
            resultsDiv.innerHTML = '<div class="info">Testing health endpoint...</div>';
            
            fetch(`${baseUrl}/health`)
                .then(response => response.json())
                .then(data => {
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Health Check Success</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                })
                .catch(error => {
                    resultsDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Health Check Failed</h3>
                            <p>Error: ${error.message}</p>
                        </div>
                    `;
                });
        }
        
        function testTileData() {
            resultsDiv.innerHTML = '<div class="info">Testing tile data endpoints...</div>';
            
            const endpoints = [
                '/api/v1/NetworkStats?id=overview_dashboard',
                '/api/v1/Agents?id=agent_visualization', 
                '/api/v1/blockchain/stats?id=blockchain_dashboard'
            ];
            
            Promise.all(endpoints.map(endpoint => 
                fetch(baseUrl + endpoint)
                    .then(response => response.json())
                    .then(data => ({ endpoint, data, success: true }))
                    .catch(error => ({ endpoint, error: error.message, success: false }))
            )).then(results => {
                let html = '<h3>üéØ Tile Data Test Results</h3>';
                
                results.forEach(result => {
                    if (result.success) {
                        html += `
                            <div class="success">
                                <strong>‚úÖ ${result.endpoint}</strong>
                                <pre>${JSON.stringify(result.data, null, 2)}</pre>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="error">
                                <strong>‚ùå ${result.endpoint}</strong>
                                <p>Error: ${result.error}</p>
                            </div>
                        `;
                    }
                });
                
                resultsDiv.innerHTML = html;
            });
        }
        
        function openLaunchpad() {
            const launchpadUrl = `${baseUrl}/`;
            window.open(launchpadUrl, '_blank');
            
            resultsDiv.innerHTML = `
                <div class="info">
                    <h3>üöÄ Opening SAP Fiori Launchpad</h3>
                    <p>Launchpad should open in a new tab: <a href="${launchpadUrl}" target="_blank">${launchpadUrl}</a></p>
                    <p><strong>What to look for:</strong></p>
                    <ul>
                        <li>SAP loading screen with blue gradient</li>
                        <li>SAP Fiori shell with header bar</li>
                        <li>Tile groups (Home, Operations, Administration)</li>
                        <li>Working tiles with live data</li>
                        <li>SAP Horizon theme styling</li>
                    </ul>
                </div>
            `;
        }
        
        function testAllEndpoints() {
            resultsDiv.innerHTML = '<div class="info">Testing all server endpoints...</div>';
            
            const endpoints = [
                '/health',
                '/',
                '/test-sap-visual.html',
                '/api/v1/NetworkStats?id=overview_dashboard',
                '/api/v1/Agents?id=agent_visualization',
                '/api/v1/blockchain/stats?id=blockchain_dashboard',
                '/api/v1/notifications/count',
                '/api/v1/operations/status'
            ];
            
            Promise.all(endpoints.map(endpoint => 
                fetch(baseUrl + endpoint)
                    .then(response => ({ 
                        endpoint, 
                        status: response.status, 
                        statusText: response.statusText,
                        success: response.ok 
                    }))
                    .catch(error => ({ 
                        endpoint, 
                        error: error.message, 
                        success: false 
                    }))
            )).then(results => {
                let html = '<h3>üîç All Endpoints Test Results</h3>';
                
                results.forEach(result => {
                    const statusClass = result.success ? 'success' : 'error';
                    const statusIcon = result.success ? '‚úÖ' : '‚ùå';
                    
                    html += `
                        <div class="${statusClass}">
                            <strong>${statusIcon} ${result.endpoint}</strong>
                            ${result.status ? `- HTTP ${result.status} ${result.statusText}` : ''}
                            ${result.error ? `- Error: ${result.error}` : ''}
                        </div>
                    `;
                });
                
                resultsDiv.innerHTML = html;
            });
        }
    </script>
</body>
</html>