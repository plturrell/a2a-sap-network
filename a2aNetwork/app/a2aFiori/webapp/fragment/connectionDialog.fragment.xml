<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form">
    
    <Dialog id="connectionDialog"
           title="{i18n>testConnection}"
           contentWidth="90%"
           maxWidth="35rem"
           contentHeight="auto"
           class="a2a-tablet-dialog"
           resizable="true">
        
        <content>
            <VBox class="sapUiMediumMargin">
                <!-- Connection Status -->
                <Panel headerText="{i18n>connectionStatus}" class="sapUiMediumMarginBottom">
                    <HBox alignItems="Center" class="sapUiSmallMargin">
                        <core:Icon src="{/statusIcon}" 
                                  color="{/statusColor}"
                                  size="1.5rem"
                                  class="sapUiMediumMarginEnd"/>
                        <VBox>
                            <Text text="{/statusText}" class="sapUiMediumText"/>
                            <Text text="{/statusDetails}" class="sapUiSmallText"/>
                        </VBox>
                    </HBox>
                    
                    <!-- Connection Progress -->
                    <ProgressIndicator percentValue="{/connectionProgress}"
                                      displayValue="{/progressText}"
                                      visible="{/showProgress}"
                                      class="sapUiSmallMarginTop"/>
                </Panel>
                
                <!-- Connection Parameters -->
                <f:SimpleForm editable="true"
                             layout="ResponsiveGridLayout"
                             labelSpanL="4"
                             labelSpanM="4">
                    <f:content>
                        <Label text="{i18n>connectionType}:" required="true"/>
                        <Select selectedKey="{/connectionType}" width="100%">
                            <items>
                                <core:Item key="agent" text="A2A Agent"/>
                                <core:Item key="blockchain" text="Blockchain Node"/>
                                <core:Item key="database" text="Database"/>
                                <core:Item key="api" text="REST API"/>
                            </items>
                        </Select>
                        
                        <Label text="{i18n>endpoint}:" required="true"/>
                        <Input value="{/endpoint}"
                              placeholder="https://example.com:8080"
                              type="Url"
                              valueLiveUpdate="true"/>
                        
                        <Label text="{i18n>timeout}:"/>
                        <StepInput value="{/timeout}"
                                  min="1"
                                  max="60"
                                  step="1"
                                  displayValuePrecision="0"
                                  valueSuffix=" seconds"/>
                        
                        <!-- Authentication Section -->
                        <Label text="{i18n>authentication}:"/>
                        <Switch state="{/requiresAuth}"
                               customTextOn="{i18n>required}"
                               customTextOff="{i18n>none}"/>
                        
                        <Label text="{i18n>apiKey}:" 
                              visible="{/requiresAuth}"/>
                        <Input value="{/apiKey}"
                              type="Password"
                              placeholder="{i18n>enterApiKey}"
                              visible="{/requiresAuth}"/>
                              
                        <Label text="{i18n>customHeaders}:"/>
                        <Switch state="{/hasCustomHeaders}"
                               customTextOn="{i18n>enabled}"
                               customTextOff="{i18n>disabled}"/>
                    </f:content>
                </f:SimpleForm>
                
                <!-- Custom Headers Table (conditional) -->
                <Panel headerText="{i18n>customHeaders}" 
                      visible="{/hasCustomHeaders}"
                      class="sapUiSmallMarginTop">
                    <Table items="{/customHeaders}" 
                           mode="Delete"
                           delete="onDeleteHeader">
                        <columns>
                            <Column>
                                <Text text="{i18n>headerName}"/>
                            </Column>
                            <Column>
                                <Text text="{i18n>headerValue}"/>
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem>
                                <cells>
                                    <Input value="{name}" placeholder="Header-Name"/>
                                    <Input value="{value}" placeholder="Header-Value"/>
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                    <Button text="{i18n>addHeader}" 
                           icon="sap-icon://add"
                           press="onAddHeader"
                           class="sapUiSmallMarginTop"/>
                </Panel>
                
                <!-- Test Results -->
                <Panel headerText="{i18n>testResults}" 
                      visible="{/showResults}"
                      class="sapUiSmallMarginTop">
                    <VBox class="sapUiSmallMargin">
                        <HBox>
                            <Label text="{i18n>responseTime}:"/>
                            <Text text="{/responseTime}ms" class="sapUiMediumMarginBegin"/>
                        </HBox>
                        <HBox>
                            <Label text="{i18n>statusCode}:"/>
                            <Text text="{/statusCode}" class="sapUiMediumMarginBegin"/>
                        </HBox>
                        <Text text="{/responseBody}" 
                             class="a2a-monospace-text sapUiSmallMarginTop"
                             maxLines="5"/>
                    </VBox>
                </Panel>
            </VBox>
        </content>
        
        <beginButton>
            <Button text="{i18n>testConnection}"
                   type="Emphasized"
                   icon="sap-icon://connected"
                   press="onTestConnection"
                   enabled="{/testEnabled}"/>
        </beginButton>
        
        <buttons>
            <Button text="{i18n>saveConnection}"
                   icon="sap-icon://save"
                   press="onSaveConnection"
                   visible="{/connectionSuccessful}"/>
        </buttons>
        
        <endButton>
            <Button text="{i18n>close}"
                   press="onConnectionDialogClose"/>
        </endButton>
    </Dialog>
</core:FragmentDefinition>