<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:u="sap.ui.unified">
    
    <Dialog id="importExportDialog"
           title="{/dialogTitle}"
           contentWidth="90%"
           maxWidth="40rem"
           contentHeight="auto"
           class="a2a-tablet-dialog"
           resizable="true">
        
        <content>
            <VBox class="sapUiMediumMargin">
                <!-- Operation Type Selection -->
                <Panel headerText="{i18n>operation}" class="sapUiMediumMarginBottom">
                    <SegmentedButton selectedKey="{/operation}" 
                                    selectionChange="onOperationChange">
                        <items>
                            <SegmentedButtonItem key="import" 
                                               text="{i18n>import}"
                                               icon="sap-icon://upload"/>
                            <SegmentedButtonItem key="export" 
                                               text="{i18n>export}"
                                               icon="sap-icon://download"/>
                        </items>
                    </SegmentedButton>
                </Panel>
                
                <!-- Import Section -->
                <VBox visible="{= ${/operation} === 'import'}">
                    <!-- Import Source -->
                    <Panel headerText="{i18n>importSource}" class="sapUiMediumMarginBottom">
                        <VBox class="sapUiSmallMargin">
                            <RadioButtonGroup selectedIndex="{/importSource}">
                                <RadioButton text="{i18n>uploadFile}" />
                                <RadioButton text="{i18n>fromUrl}" />
                                <RadioButton text="{i18n>pasteData}" />
                            </RadioButtonGroup>
                            
                            <!-- File Upload -->
                            <VBox visible="{= ${/importSource} === 0}" class="sapUiSmallMarginTop">
                                <u:FileUploader id="fileUploader"
                                              name="importFile"
                                              uploadUrl="/api/import/upload"
                                              typeMissmatch="onFileMismatch"
                                              change="onFileChange"
                                              class="sapUiMediumMarginBottom"/>
                                <Text text="{i18n>supportedFormats}: JSON, CSV, XML" 
                                     class="sapUiSmallText"/>
                            </VBox>
                            
                            <!-- URL Import -->
                            <VBox visible="{= ${/importSource} === 1}" class="sapUiSmallMarginTop">
                                <Input value="{/importUrl}"
                                      placeholder="https://example.com/data.json"
                                      type="Url"/>
                            </VBox>
                            
                            <!-- Paste Data -->
                            <VBox visible="{= ${/importSource} === 2}" class="sapUiSmallMarginTop">
                                <TextArea value="{/pasteData}"
                                         placeholder="{i18n>pasteDataHere}"
                                         rows="6"/>
                            </VBox>
                        </VBox>
                    </Panel>
                    
                    <!-- Import Options -->
                    <Panel headerText="{i18n>importOptions}">
                        <VBox class="sapUiSmallMargin">
                            <CheckBox text="{i18n>validateData}"
                                     selected="{/validateOnImport}"/>
                            <CheckBox text="{i18n>overwriteExisting}"
                                     selected="{/overwriteExisting}"/>
                            <CheckBox text="{i18n>createBackup}"
                                     selected="{/createBackupOnImport}"/>
                            
                            <Label text="{i18n>conflictResolution}:" class="sapUiSmallMarginTop"/>
                            <Select selectedKey="{/conflictResolution}">
                                <core:Item key="skip" text="{i18n>skipConflicts}"/>
                                <core:Item key="overwrite" text="{i18n>overwriteAll}"/>
                                <core:Item key="merge" text="{i18n>mergeData}"/>
                                <core:Item key="ask" text="{i18n>askForEach}"/>
                            </Select>
                        </VBox>
                    </Panel>
                </VBox>
                
                <!-- Export Section -->
                <VBox visible="{= ${/operation} === 'export'}">
                    <!-- Data Selection -->
                    <Panel headerText="{i18n>dataSelection}" class="sapUiMediumMarginBottom">
                        <VBox class="sapUiSmallMargin">
                            <Label text="{i18n>exportScope}:"/>
                            <RadioButtonGroup selectedIndex="{/exportScope}">
                                <RadioButton text="{i18n>allData}"/>
                                <RadioButton text="{i18n>currentView}"/>
                                <RadioButton text="{i18n>selectedItems}"/>
                                <RadioButton text="{i18n>dateRange}"/>
                            </RadioButtonGroup>
                            
                            <!-- Date Range Selection -->
                            <VBox visible="{= ${/exportScope} === 3}" class="sapUiSmallMarginTop">
                                <HBox>
                                    <DatePicker value="{/exportDateFrom}"
                                               placeholder="{i18n>from}"
                                               class="sapUiMediumMarginEnd"/>
                                    <DatePicker value="{/exportDateTo}"
                                               placeholder="{i18n>to}"/>
                                </HBox>
                            </VBox>
                        </VBox>
                    </Panel>
                    
                    <!-- Export Format -->
                    <Panel headerText="{i18n>exportFormat}" class="sapUiMediumMarginBottom">
                        <VBox class="sapUiSmallMargin">
                            <RadioButtonGroup selectedIndex="{/exportFormat}">
                                <RadioButton text="JSON"/>
                                <RadioButton text="CSV"/>
                                <RadioButton text="XML"/>
                                <RadioButton text="Excel (.xlsx)"/>
                            </RadioButtonGroup>
                        </VBox>
                    </Panel>
                    
                    <!-- Export Options -->
                    <Panel headerText="{i18n>exportOptions}">
                        <VBox class="sapUiSmallMargin">
                            <CheckBox text="{i18n>includeMetadata}"
                                     selected="{/includeMetadata}"/>
                            <CheckBox text="{i18n>compressFile}"
                                     selected="{/compressExport}"/>
                            <CheckBox text="{i18n>includeHeaders}"
                                     selected="{/includeHeaders}"
                                     visible="{= ${/exportFormat} === 1}"/>
                                     
                            <Label text="{i18n>fileName}:" class="sapUiSmallMarginTop"/>
                            <Input value="{/exportFileName}"
                                  placeholder="export-{timestamp}"/>
                        </VBox>
                    </Panel>
                </VBox>
                
                <!-- Progress Section -->
                <Panel headerText="{i18n>progress}" 
                      visible="{/showProgress}"
                      class="sapUiSmallMarginTop">
                    <VBox class="sapUiSmallMargin">
                        <ProgressIndicator percentValue="{/progressPercent}"
                                          displayValue="{/progressText}"/>
                        <Text text="{/progressDetails}" class="sapUiSmallMarginTop"/>
                        
                        <MessageStrip text="{/statusMessage}"
                                    type="{/statusType}"
                                    showIcon="true"
                                    visible="{/showStatus}"
                                    class="sapUiSmallMarginTop"/>
                    </VBox>
                </Panel>
                
                <!-- Results/Errors -->
                <Panel headerText="{i18n>results}" 
                      visible="{/showResults}"
                      class="sapUiSmallMarginTop">
                    <VBox class="sapUiSmallMargin">
                        <HBox>
                            <Text text="{i18n>processed}: "/>
                            <Text text="{/processedCount}" class="sapUiMediumMarginBegin"/>
                        </HBox>
                        <HBox>
                            <Text text="{i18n>successful}: "/>
                            <Text text="{/successCount}" class="sapUiMediumMarginBegin"/>
                        </HBox>
                        <HBox>
                            <Text text="{i18n>errors}: "/>
                            <Text text="{/errorCount}" class="sapUiMediumMarginBegin"/>
                        </HBox>
                        
                        <!-- Error Details -->
                        <List items="{/errors}" 
                             visible="{= ${/errorCount} > 0}"
                             class="sapUiSmallMarginTop">
                            <StandardListItem title="{message}" 
                                            description="Line: {line}"
                                            icon="sap-icon://error"
                                            iconInset="false"/>
                        </List>
                        
                        <!-- Download Link -->
                        <Link text="{i18n>downloadResult}"
                             href="{/downloadUrl}"
                             target="_blank"
                             visible="{/showDownload}"
                             class="sapUiSmallMarginTop"/>
                    </VBox>
                </Panel>
            </VBox>
        </content>
        
        <beginButton>
            <Button text="{/primaryButtonText}"
                   type="Emphasized"
                   icon="{/primaryButtonIcon}"
                   press="onExecuteOperation"
                   enabled="{/operationEnabled}"/>
        </beginButton>
        
        <buttons>
            <Button text="{i18n>cancel}"
                   icon="sap-icon://stop"
                   press="onCancelOperation"
                   visible="{/showCancelButton}"/>
        </buttons>
        
        <endButton>
            <Button text="{i18n>close}"
                   press="onImportExportDialogClose"/>
        </endButton>
    </Dialog>
</core:FragmentDefinition>