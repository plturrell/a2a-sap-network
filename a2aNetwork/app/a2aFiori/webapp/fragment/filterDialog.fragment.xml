<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout">
    
    <Dialog id="filterDialog"
           title="{i18n>advancedFilters}"
           contentWidth="90%"
           maxWidth="45rem"
           contentHeight="auto"
           class="a2a-tablet-dialog"
           resizable="true"
           draggable="true">
        
        <content>
            <VBox class="sapUiMediumMargin">
                <!-- Quick Filter Presets -->
                <Panel headerText="{i18n>quickFilters}" class="sapUiMediumMarginBottom">
                    <layout:HorizontalLayout class="sapUiSmallMargin">
                        <Button text="{i18n>today}"
                               press="onApplyQuickFilter"
                               data-filter="today"
                               class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>lastWeek}"
                               press="onApplyQuickFilter"
                               data-filter="week"
                               class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>lastMonth}"
                               press="onApplyQuickFilter"
                               data-filter="month"
                               class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>active}"
                               press="onApplyQuickFilter"
                               data-filter="active"
                               class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>errors}"
                               press="onApplyQuickFilter"
                               data-filter="errors"
                               type="Attention"/>
                    </layout:HorizontalLayout>
                </Panel>
                
                <!-- Custom Filter Builder -->
                <Panel headerText="{i18n>customFilters}">
                    <!-- Filter Tabs -->
                    <IconTabBar selectedKey="{/selectedFilterTab}"
                               select="onFilterTabSelect"
                               class="sapUiMediumMarginBottom">
                        <items>
                            <IconTabFilter key="basic" 
                                          text="{i18n>basic}"
                                          icon="sap-icon://filter"/>
                            <IconTabFilter key="advanced" 
                                          text="{i18n>advanced}"
                                          icon="sap-icon://detail-view"/>
                            <IconTabFilter key="saved" 
                                          text="{i18n>savedFilters}"
                                          icon="sap-icon://save"/>
                        </items>
                        <content>
                            <!-- Basic Filters -->
                            <VBox visible="{= ${/selectedFilterTab} === 'basic'}">
                                <f:SimpleForm editable="true"
                                             layout="ResponsiveGridLayout"
                                             labelSpanL="3"
                                             labelSpanM="3">
                                    <f:content>
                                        <!-- Date Range -->
                                        <Label text="{i18n>dateRange}:"/>
                                        <HBox>
                                            <DatePicker value="{/filters/dateFrom}"
                                                       placeholder="{i18n>from}"
                                                       class="sapUiMediumMarginEnd"/>
                                            <DatePicker value="{/filters/dateTo}"
                                                       placeholder="{i18n>to}"/>
                                        </HBox>
                                        
                                        <!-- Status Filter -->
                                        <Label text="{i18n>status}:"/>
                                        <MultiComboBox selectedKeys="{/filters/status}"
                                                      items="{/statusOptions}">
                                            <core:Item key="{key}" text="{text}"/>
                                        </MultiComboBox>
                                        
                                        <!-- Type Filter -->
                                        <Label text="{i18n>type}:"/>
                                        <MultiComboBox selectedKeys="{/filters/type}"
                                                      items="{/typeOptions}">
                                            <core:Item key="{key}" text="{text}"/>
                                        </MultiComboBox>
                                        
                                        <!-- Priority Filter -->
                                        <Label text="{i18n>priority}:"/>
                                        <SegmentedButton selectedKey="{/filters/priority}">
                                            <items>
                                                <SegmentedButtonItem key="all" text="{i18n>all}"/>
                                                <SegmentedButtonItem key="high" text="{i18n>high}"/>
                                                <SegmentedButtonItem key="medium" text="{i18n>medium}"/>
                                                <SegmentedButtonItem key="low" text="{i18n>low}"/>
                                            </items>
                                        </SegmentedButton>
                                        
                                        <!-- Text Search -->
                                        <Label text="{i18n>search}:"/>
                                        <Input value="{/filters/searchText}"
                                              placeholder="{i18n>searchInFields}"
                                              showClearIcon="true"/>
                                    </f:content>
                                </f:SimpleForm>
                            </VBox>
                            
                            <!-- Advanced Filters -->
                            <VBox visible="{= ${/selectedFilterTab} === 'advanced'}">
                                <!-- Custom Filter Rules -->
                                <Table items="{/customRules}" mode="Delete" delete="onDeleteRule">
                                    <headerToolbar>
                                        <Toolbar>
                                            <Title text="{i18n>filterRules}"/>
                                            <ToolbarSpacer/>
                                            <Button text="{i18n>addRule}"
                                                   icon="sap-icon://add"
                                                   press="onAddRule"/>
                                        </Toolbar>
                                    </headerToolbar>
                                    <columns>
                                        <Column>
                                            <Text text="{i18n>field}"/>
                                        </Column>
                                        <Column>
                                            <Text text="{i18n>operator}"/>
                                        </Column>
                                        <Column>
                                            <Text text="{i18n>value}"/>
                                        </Column>
                                        <Column width="4rem">
                                            <Text text="{i18n>logic}"/>
                                        </Column>
                                    </columns>
                                    <items>
                                        <ColumnListItem>
                                            <cells>
                                                <Select selectedKey="{field}" items="{/fieldOptions}">
                                                    <core:Item key="{key}" text="{text}"/>
                                                </Select>
                                                <Select selectedKey="{operator}" items="{/operatorOptions}">
                                                    <core:Item key="{key}" text="{text}"/>
                                                </Select>
                                                <Input value="{value}" placeholder="{i18n>enterValue}"/>
                                                <Select selectedKey="{logic}" enabled="{hasNext}">
                                                    <core:Item key="and" text="AND"/>
                                                    <core:Item key="or" text="OR"/>
                                                </Select>
                                            </cells>
                                        </ColumnListItem>
                                    </items>
                                </Table>
                            </VBox>
                            
                            <!-- Saved Filters -->
                            <VBox visible="{= ${/selectedFilterTab} === 'saved'}">
                                <List items="{/savedFilters}" 
                                     mode="SingleSelectMaster"
                                     selectionChange="onSavedFilterSelect">
                                    <StandardListItem title="{name}"
                                                    description="{description}"
                                                    info="{createdDate}"
                                                    type="Active"/>
                                </List>
                                
                                <Panel headerText="{i18n>saveCurrentFilter}" 
                                      class="sapUiMediumMarginTop">
                                    <VBox class="sapUiSmallMargin">
                                        <Input value="{/newFilterName}"
                                              placeholder="{i18n>filterName}"/>
                                        <Input value="{/newFilterDescription}"
                                              placeholder="{i18n>description}"
                                              class="sapUiTinyMarginTop"/>
                                        <HBox class="sapUiSmallMarginTop">
                                            <Button text="{i18n>saveFilter}"
                                                   icon="sap-icon://save"
                                                   press="onSaveFilter"
                                                   type="Emphasized"/>
                                            <Button text="{i18n>deleteSelected}"
                                                   icon="sap-icon://delete"
                                                   press="onDeleteSavedFilter"
                                                   type="Attention"
                                                   enabled="{/hasSavedFilterSelected}"
                                                   class="sapUiSmallMarginBegin"/>
                                        </HBox>
                                    </VBox>
                                </Panel>
                            </VBox>
                        </content>
                    </IconTabBar>
                </Panel>
                
                <!-- Filter Summary -->
                <Panel headerText="{i18n>filterSummary}" 
                      visible="{/hasActiveFilters}"
                      class="sapUiSmallMarginTop">
                    <VBox class="sapUiSmallMargin">
                        <Text text="{i18n>activeFilters}: {/activeFilterCount}"/>
                        <List items="{/activeFilterSummary}" showSeparators="None">
                            <CustomListItem>
                                <HBox alignItems="Center">
                                    <Text text="{text}" class="sapUiMediumMarginEnd"/>
                                    <Button icon="sap-icon://delete"
                                           type="Transparent"
                                           press="onRemoveFilter"
                                           tooltip="{i18n>removeFilter}"/>
                                </HBox>
                            </CustomListItem>
                        </List>
                    </VBox>
                </Panel>
            </VBox>
        </content>
        
        <beginButton>
            <Button text="{i18n>applyFilters}"
                   type="Emphasized"
                   icon="sap-icon://filter"
                   press="onApplyFilters"/>
        </beginButton>
        
        <buttons>
            <Button text="{i18n>clearAll}"
                   icon="sap-icon://clear-filter"
                   press="onClearAllFilters"/>
            <Button text="{i18n>reset}"
                   icon="sap-icon://reset"
                   press="onResetFilters"/>
        </buttons>
        
        <endButton>
            <Button text="{i18n>cancel}"
                   press="onFilterDialogCancel"/>
        </endButton>
    </Dialog>
</core:FragmentDefinition>