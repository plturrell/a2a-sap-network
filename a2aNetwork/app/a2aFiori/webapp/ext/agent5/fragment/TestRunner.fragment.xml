<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:mc="sap.suite.ui.microchart">
    
    <Dialog
        id="testRunnerDialog"
        title="Test Runner - Execution Control"
        contentWidth="{= ${device>/system/phone} ? '100%' : '90%' }"
        contentHeight="{= ${device>/system/phone} ? '100%' : '85%' }"
        resizable="{= !${device>/system/phone} }"
        stretch="{device>/system/phone}"
        aria-label="Test execution dialog for running and monitoring test suites"
        role="dialog">
        
        <content>
            <l:Splitter height="100%" orientation="Horizontal">
                <l:contentAreas>
                    <!-- Configuration Panel -->
                    <Panel 
                        headerText="Execution Configuration" 
                        width="{= ${device>/system/phone} ? '100%' : '40%' }"
                        aria-label="Test execution configuration settings">
                        <content>
                            <VBox class="sapUiMediumMargin">
                                <!-- Test Suite Selection -->
                                <VBox>
                                    <Label text="Test Suite" labelFor="testSuiteSelect"/>
                                    <Select 
                                        id="testSuiteSelect"
                                        selectedKey="{runner>/selectedSuite}"
                                        items="{runner>/availableSuites}"
                                        aria-label="Select test suite to execute"
                                        tooltip="Choose the test suite you want to run">
                                        <core:ListItem 
                                            key="{runner>id}"
                                            text="{runner>name} ({runner>testCount} tests)"/>
                                    </Select>
                                </VBox>
                                
                                <!-- Execution Settings -->
                                <VBox class="sapUiMediumMarginTop">
                                    <Label text="Execution Mode" labelFor="executionModeGroup"/>
                                    <RadioButtonGroup 
                                        id="executionModeGroup"
                                        selectedIndex="{= ${runner>/executionMode} === 'SEQUENTIAL' ? 0 : 1 }"
                                        aria-label="Select test execution mode">
                                        <RadioButton text="Sequential"/>
                                        <RadioButton text="Parallel"/>
                                    </RadioButtonGroup>
                                </VBox>
                                
                                <VBox class="sapUiMediumMarginTop">
                                    <Label text="Environment" labelFor="environmentSelect"/>
                                    <Select 
                                        id="environmentSelect"
                                        selectedKey="{runner>/environment}"
                                        aria-label="Select test environment"
                                        tooltip="Choose the environment where tests will run">
                                        <items>
                                            <core:Item key="DEV" text="Development"/>
                                            <core:Item key="TEST" text="Test"/>
                                            <core:Item key="STAGING" text="Staging"/>
                                            <core:Item key="PROD" text="Production"/>
                                        </items>
                                    </Select>
                                </VBox>
                                
                                <VBox class="sapUiMediumMarginTop">
                                    <Label text="Parallel Threads" labelFor="parallelThreadsSlider"/>
                                    <Slider 
                                        id="parallelThreadsSlider"
                                        value="{runner>/parallelThreads}"
                                        min="1"
                                        max="10"
                                        step="1"
                                        enableTickmarks="true"
                                        inputsAsTooltips="true"
                                        visible="{= ${runner>/executionMode} === 'PARALLEL' }"
                                        aria-label="Number of parallel threads for test execution"
                                        aria-valuemin="1"
                                        aria-valuemax="10"
                                        aria-valuenow="{runner>/parallelThreads}"/>
                                </VBox>
                                
                                <VBox class="sapUiMediumMarginTop">
                                    <Label text="Retry Attempts" labelFor="retryAttemptsInput"/>
                                    <StepInput 
                                        id="retryAttemptsInput"
                                        value="{runner>/retryAttempts}"
                                        min="0"
                                        max="5"
                                        step="1"
                                        aria-label="Number of retry attempts for failed tests"
                                        tooltip="Set how many times to retry failed tests"/>
                                </VBox>
                                
                                <!-- Test Filters -->
                                <Panel 
                                    headerText="Test Filters"
                                    expandable="true"
                                    expanded="true"
                                    class="sapUiMediumMarginTop">
                                    <VBox>
                                        <CheckBox 
                                            text="Include smoke tests"
                                            selected="{runner>/testFilters/includeSmoke}"
                                            aria-label="Include smoke tests in execution"/>
                                        <CheckBox 
                                            text="Include regression tests"
                                            selected="{runner>/testFilters/includeRegression}"
                                            aria-label="Include regression tests in execution"/>
                                        
                                        <Label text="Priority Filter"/>
                                        <Select selectedKey="{runner>/testFilters/priorityFilter}">
                                            <items>
                                                <core:Item key="ALL" text="All Priorities"/>
                                                <core:Item key="P1" text="P1 Only"/>
                                                <core:Item key="P1_P2" text="P1 & P2"/>
                                                <core:Item key="P3_P4" text="P3 & P4"/>
                                            </items>
                                        </Select>
                                    </VBox>
                                </Panel>
                                
                                <!-- Reporting Options -->
                                <Panel 
                                    headerText="Reporting"
                                    expandable="true"
                                    expanded="false"
                                    class="sapUiMediumMarginTop">
                                    <VBox>
                                        <CheckBox 
                                            text="Generate execution report"
                                            selected="{runner>/generateReport}"/>
                                        <CheckBox 
                                            text="Send notification on completion"
                                            selected="{runner>/notifyOnCompletion}"/>
                                        <CheckBox 
                                            text="Capture screenshots"
                                            selected="{runner>/captureScreenshots}"/>
                                    </VBox>
                                </Panel>
                                
                                <!-- Execution Control -->
                                <VBox class="sapUiMediumMarginTop">
                                    <Button 
                                        text="Start Execution"
                                        type="Emphasized"
                                        icon="sap-icon://play"
                                        press=".onExecuteTestSuite"
                                        enabled="{runner>/selectedSuite}"
                                        aria-label="Start test suite execution"
                                        tooltip="Begin running the selected test suite"/>
                                </VBox>
                            </VBox>
                        </content>
                    </Panel>
                    
                    <!-- Execution Monitor Panel -->
                    <Panel 
                        headerText="Execution Monitor" 
                        width="{= ${device>/system/phone} ? '100%' : '60%' }"
                        aria-label="Test execution monitoring and results"
                        visible="{= !${device>/system/phone} || ${runner>/isRunning} }">
                        <content>
                            <VBox>
                                <!-- Execution Summary -->
                                <Panel headerText="Execution Summary">
                                    <l:Grid defaultSpan="L3 M6 S12">
                                        <l:content>
                                            <mc:RadialMicroChart
                                                id="overallProgress"
                                                size="M"
                                                percentage="{runner>/executionProgress}"
                                                press=".onProgressPress"/>
                                            
                                            <VBox>
                                                <Title text="Tests Executed" level="H4"/>
                                                <Text text="{runner>/testsExecuted} / {runner>/totalTests}"/>
                                            </VBox>
                                            
                                            <VBox>
                                                <Title text="Success Rate" level="H4"/>
                                                <Text text="{runner>/successRate}%"/>
                                            </VBox>
                                            
                                            <VBox>
                                                <Title text="Elapsed Time" level="H4"/>
                                                <Text text="{runner>/elapsedTime}"/>
                                            </VBox>
                                        </l:content>
                                    </l:Grid>
                                </Panel>
                                
                                <!-- Real-time Test Results -->
                                <Panel 
                                    headerText="Test Results"
                                    class="sapUiMediumMarginTop">
                                    <Table
                                        items="{runner>/executionResults}"
                                        mode="None"
                                        growing="true"
                                        growingThreshold="{= ${device>/system/phone} ? 10 : 20 }"
                                        sticky="{= ${device>/system/desktop} ? 'ColumnHeaders' : '' }"
                                        aria-label="Test execution results table">
                                        <columns>
                                            <Column>
                                                <Text text="Test Name"/>
                                            </Column>
                                            <Column>
                                                <Text text="Status"/>
                                            </Column>
                                            <Column>
                                                <Text text="Duration"/>
                                            </Column>
                                            <Column>
                                                <Text text="Error"/>
                                            </Column>
                                        </columns>
                                        <items>
                                            <ColumnListItem>
                                                <cells>
                                                    <Text text="{runner>testName}"/>
                                                    <ObjectStatus 
                                                        text="{runner>status}"
                                                        state="{= ${runner>status} === 'PASS' ? 'Success' : ${runner>status} === 'FAIL' ? 'Error' : 'None' }"/>
                                                    <Text text="{runner>duration}ms"/>
                                                    <Text 
                                                        text="{runner>error}"
                                                        maxLines="2"/>
                                                </cells>
                                            </ColumnListItem>
                                        </items>
                                    </Table>
                                </Panel>
                                
                                <!-- Execution Controls -->
                                <Toolbar class="sapUiMediumMarginTop">
                                    <Button 
                                        text="{= ${device>/system/phone} ? '' : 'Pause' }"
                                        icon="sap-icon://pause"
                                        press=".onPauseExecution"
                                        enabled="{runner>/isRunning}"
                                        aria-label="Pause test execution"
                                        tooltip="Pause the current test execution"/>
                                    <Button 
                                        text="{= ${device>/system/phone} ? '' : 'Stop' }"
                                        icon="sap-icon://stop"
                                        press=".onStopExecution"
                                        enabled="{runner>/isRunning}"
                                        aria-label="Stop test execution"
                                        tooltip="Stop the current test execution"/>
                                    <ToolbarSpacer/>
                                    <Button 
                                        text="View Logs"
                                        icon="sap-icon://log"
                                        press=".onViewLogs"/>
                                    <Button 
                                        text="Export Results"
                                        icon="sap-icon://excel-attachment"
                                        press=".onExportResults"/>
                                </Toolbar>
                            </VBox>
                        </content>
                    </Panel>
                </l:contentAreas>
            </l:Splitter>
        </content>
        
        <beginButton>
            <Button 
                text="Close" 
                press=".onCloseTestRunner"
                aria-label="Close test runner dialog"/>
        </beginButton>
        
        <endButton>
            <Button 
                text="{= ${device>/system/phone} ? 'Save' : 'Save Configuration' }"
                press=".onSaveConfiguration"
                aria-label="Save test configuration settings"/>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>