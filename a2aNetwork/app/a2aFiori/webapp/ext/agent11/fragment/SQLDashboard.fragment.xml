<?xml version="1.0" encoding="UTF-8"?>
<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:suite="sap.suite.ui.commons"
    xmlns:viz="sap.viz">
    
    <Dialog
        title="{i18n>dialog.sqlDashboard.title}"
        class="sapUiMediumMargin"
        contentWidth="95vw"
        contentHeight="90vh"
        resizable="true"
        draggable="true">
        
        <content>
            <Page showHeader="false">
                <content>
                    
                    <!-- Key Performance Indicators -->
                    <Panel headerText="{i18n>section.keyMetrics}" class="sapUiMediumMargin">
                        <content>
                            <FlexBox wrap="Wrap" class="sapUiSmallMargin">
                                
                                <!-- Total Queries -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.totalQueries}"
                                    subheaderText="{i18n>kpi.allTime}"
                                    valueColor="Good"
                                    indicator="Up"
                                    value="45,287"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                                <!-- Active Queries -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.activeQueries}"
                                    subheaderText="{i18n>kpi.currentlyRunning}"
                                    valueColor="Neutral"
                                    indicator="None"
                                    value="12"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                                <!-- Query Success Rate -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.successRate}"
                                    subheaderText="{i18n>kpi.last24Hours}"
                                    valueColor="Good"
                                    indicator="Up"
                                    value="98.5%"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                                <!-- Average Response Time -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.avgResponseTime}"
                                    subheaderText="{i18n>kpi.milliseconds}"
                                    valueColor="Good"
                                    indicator="Down"
                                    value="247ms"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                                <!-- Database Connections -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.dbConnections}"
                                    subheaderText="{i18n>kpi.activeConnections}"
                                    valueColor="Good"
                                    indicator="None"
                                    value="156"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                                <!-- Cache Hit Rate -->
                                <suite:NumericTile
                                    headerText="{i18n>kpi.cacheHitRate}"
                                    subheaderText="{i18n>kpi.queryCache}"
                                    valueColor="Good"
                                    indicator="Up"
                                    value="89.3%"
                                    size="M"
                                    class="sapUiTinyMargin"/>
                                
                            </FlexBox>
                        </content>
                    </Panel>
                    
                    <!-- Performance Charts Section -->
                    <Panel headerText="{i18n>section.performanceAnalysis}" class="sapUiMediumMargin">
                        <content>
                            <HBox class="sapUiMediumMargin">
                                
                                <!-- Execution Trends Chart -->
                                <VBox class="sapUiMediumMarginEnd" width="50%">
                                    <Title text="{i18n>chart.executionTrends}" level="H4" class="sapUiSmallMarginBottom"/>
                                    <viz:Popover id="executionTrendsPopover"/>
                                    <viz:VizFrame
                                        id="executionTrendsChart"
                                        vizType="line"
                                        width="100%"
                                        height="300px">
                                        <viz:dataset>
                                            <viz:FlattenedDataset data="{/executionTrends}">
                                                <viz:dimensions>
                                                    <viz:DimensionDefinition name="Time" value="{timestamp}"/>
                                                </viz:dimensions>
                                                <viz:measures>
                                                    <viz:MeasureDefinition name="Queries" value="{queryCount}"/>
                                                    <viz:MeasureDefinition name="Response Time" value="{responseTime}"/>
                                                    <viz:MeasureDefinition name="Success Rate" value="{successRate}"/>
                                                </viz:measures>
                                            </viz:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <viz:FeedItem uid="categoryAxis" type="Dimension" values="Time"/>
                                            <viz:FeedItem uid="valueAxis" type="Measure" values="Queries,Response Time,Success Rate"/>
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </VBox>
                                
                                <!-- Query Type Distribution Chart -->
                                <VBox width="50%">
                                    <Title text="{i18n>chart.queryTypes}" level="H4" class="sapUiSmallMarginBottom"/>
                                    <viz:Popover id="queryTypesPopover"/>
                                    <viz:VizFrame
                                        id="queryTypesChart"
                                        vizType="donut"
                                        width="100%"
                                        height="300px">
                                        <viz:dataset>
                                            <viz:FlattenedDataset data="{/queryTypes}">
                                                <viz:dimensions>
                                                    <viz:DimensionDefinition name="QueryType" value="{queryType}"/>
                                                </viz:dimensions>
                                                <viz:measures>
                                                    <viz:MeasureDefinition name="Count" value="{count}"/>
                                                </viz:measures>
                                            </viz:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <viz:FeedItem uid="color" type="Dimension" values="QueryType"/>
                                            <viz:FeedItem uid="size" type="Measure" values="Count"/>
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </VBox>
                                
                            </HBox>
                        </content>
                    </Panel>
                    
                    <!-- Database Utilization Section -->
                    <Panel headerText="{i18n>section.databaseUtilization}" class="sapUiMediumMargin">
                        <content>
                            <HBox class="sapUiMediumMargin">
                                
                                <!-- Connection Pool Usage -->
                                <VBox class="sapUiMediumMarginEnd" width="25%">
                                    <Title text="{i18n>metric.connectionPoolUsage}" level="H5" class="sapUiSmallMarginBottom"/>
                                    <suite:RadialMicroChart
                                        size="M"
                                        percentage="67"
                                        valueColor="Good"
                                        class="sapUiSmallMargin"/>
                                    <Text text="67%" class="sapUiSmallMarginTop"/>
                                </VBox>
                                
                                <!-- Buffer Hit Ratio -->
                                <VBox class="sapUiMediumMarginEnd" width="25%">
                                    <Title text="{i18n>metric.bufferHitRatio}" level="H5" class="sapUiSmallMarginBottom"/>
                                    <suite:RadialMicroChart
                                        size="M"
                                        percentage="94"
                                        valueColor="Good"
                                        class="sapUiSmallMargin"/>
                                    <Text text="94%" class="sapUiSmallMarginTop"/>
                                </VBox>
                                
                                <!-- Index Utilization -->
                                <VBox class="sapUiMediumMarginEnd" width="25%">
                                    <Title text="{i18n>metric.indexUtilization}" level="H5" class="sapUiSmallMarginBottom"/>
                                    <suite:RadialMicroChart
                                        size="M"
                                        percentage="78"
                                        valueColor="Good"
                                        class="sapUiSmallMargin"/>
                                    <Text text="78%" class="sapUiSmallMarginTop"/>
                                </VBox>
                                
                                <!-- Lock Wait Time -->
                                <VBox width="25%">
                                    <Title text="{i18n>metric.lockWaitTime}" level="H5" class="sapUiSmallMarginBottom"/>
                                    <suite:RadialMicroChart
                                        size="M"
                                        percentage="15"
                                        valueColor="Good"
                                        class="sapUiSmallMargin"/>
                                    <Text text="15ms" class="sapUiSmallMarginTop"/>
                                </VBox>
                                
                            </HBox>
                        </content>
                    </Panel>
                    
                    <!-- Active Queries Table -->
                    <Panel headerText="{i18n>section.activeQueries}" class="sapUiMediumMargin">
                        <content>
                            <Table
                                id="activeQueriesTable"
                                items="{/activeQueries}"
                                mode="None"
                                class="sapUiSmallMarginTop">
                                
                                <columns>
                                    <Column>
                                        <Text text="{i18n>field.queryName}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.queryType}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.databaseType}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.progress}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.executionTime}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.status}"/>
                                    </Column>
                                </columns>
                                
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{queryName}"/>
                                            <Text text="{queryType}"/>
                                            <Text text="{databaseType}"/>
                                            <ProgressIndicator
                                                percentValue="{progress}"
                                                displayValue="{progress}%"
                                                state="Success"/>
                                            <Text text="{executionTime} {i18n>unit.milliseconds}"/>
                                            <ObjectStatus
                                                text="{executionStatus}"
                                                state="{
                                                    path: 'executionStatus',
                                                    formatter: '.formatStatusState'
                                                }"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </content>
                    </Panel>
                    
                    <!-- Database Connections Status -->
                    <Panel headerText="{i18n>section.databaseConnections}" class="sapUiMediumMargin">
                        <content>
                            <Table
                                id="connectionsTable"
                                items="{/databaseConnections}"
                                mode="None"
                                class="sapUiSmallMarginTop">
                                
                                <columns>
                                    <Column>
                                        <Text text="{i18n>field.connectionName}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.databaseType}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.serverHost}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.activeConnections}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.connectionPool}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.performance}"/>
                                    </Column>
                                    <Column>
                                        <Text text="{i18n>field.status}"/>
                                    </Column>
                                </columns>
                                
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{connectionName}"/>
                                            <Text text="{databaseType}"/>
                                            <Text text="{serverHost}"/>
                                            <Text text="{activeConnections}"/>
                                            <Text text="{connectionPool}"/>
                                            <RatingIndicator
                                                value="{performance}"
                                                maxValue="5"
                                                class="sapUiTinyMargin"/>
                                            <ObjectStatus
                                                text="{connectionStatus}"
                                                state="{
                                                    path: 'connectionStatus',
                                                    formatter: '.formatConnectionState'
                                                }"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </content>
                    </Panel>
                    
                    <!-- Error Analysis Section -->
                    <Panel headerText="{i18n>section.errorAnalysis}" class="sapUiMediumMargin">
                        <content>
                            <HBox class="sapUiMediumMargin">
                                
                                <!-- Error Distribution Chart -->
                                <VBox class="sapUiMediumMarginEnd" width="60%">
                                    <Title text="{i18n>chart.errorAnalysis}" level="H4" class="sapUiSmallMarginBottom"/>
                                    <viz:Popover id="errorAnalysisPopover"/>
                                    <viz:VizFrame
                                        id="errorAnalysisChart"
                                        vizType="column"
                                        width="100%"
                                        height="250px">
                                        <viz:dataset>
                                            <viz:FlattenedDataset data="{/errorDistribution}">
                                                <viz:dimensions>
                                                    <viz:DimensionDefinition name="ErrorType" value="{errorType}"/>
                                                </viz:dimensions>
                                                <viz:measures>
                                                    <viz:MeasureDefinition name="Count" value="{count}"/>
                                                </viz:measures>
                                            </viz:FlattenedDataset>
                                        </viz:dataset>
                                        <viz:feeds>
                                            <viz:FeedItem uid="categoryAxis" type="Dimension" values="ErrorType"/>
                                            <viz:FeedItem uid="valueAxis" type="Measure" values="Count"/>
                                        </viz:feeds>
                                    </viz:VizFrame>
                                </VBox>
                                
                                <!-- Query Optimization Statistics -->
                                <VBox width="40%">
                                    <Title text="{i18n>section.optimizationStats}" level="H4" class="sapUiSmallMarginBottom"/>
                                    
                                    <List items="{/optimizationStats}" class="sapUiSmallMarginTop">
                                        <StandardListItem
                                            title="{optimizationType}"
                                            description="{description}"
                                            info="{improvementPercentage}%"
                                            infoState="{
                                                path: 'improvementPercentage',
                                                formatter: '.formatImprovementState'
                                            }"/>
                                    </List>
                                </VBox>
                                
                            </HBox>
                        </content>
                    </Panel>
                    
                </content>
            </Page>
        </content>
        
        <beginButton>
            <Button text="{i18n>btn.refresh}" press="onRefreshDashboard" type="Emphasized"/>
        </beginButton>
        <endButton>
            <Button text="{i18n>btn.close}" press="onCloseDashboard"/>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>