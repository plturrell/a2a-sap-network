<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:mc="sap.suite.ui.microchart">
    
    <Dialog
        id="inferenceResultsDialog"
        title="Inference Results"
        contentWidth="85%"
        contentHeight="75%"
        resizable="true"
        draggable="true">
        
        <content>
            <VBox class="sapUiMediumMargin">
                <!-- Results Summary ---->
                <Panel headerText="Inference Session Summary" class="sapUiMediumMarginBottom">
                    <HBox class="sapUiMediumMargin">
                        <VBox class="sapUiMediumMarginEnd">
                            <Title text="Total Inferences" level="H5"/>
                            <ObjectNumber 
                                number="{inferenceResults>/summary/totalInferences}"
                                state="Information"
                                emphasized="true"/>
                        </VBox>
                        <VBox class="sapUiMediumMarginEnd">
                            <Title text="Success Rate" level="H5"/>
                            <mc:RadialMicroChart
                                size="M"
                                percentage="{inferenceResults>/summary/successRate}"
                                valueColor="{= ${inferenceResults>/summary/successRate} >= 90 ? 'Good' : ${inferenceResults>/summary/successRate} >= 70 ? 'Critical' : 'Error'}"/>
                            <Text text="{inferenceResults>/summary/successRate}%" class="sapUiTinyMarginTop"/>
                        </VBox>
                        <VBox class="sapUiMediumMarginEnd">
                            <Title text="Avg Confidence" level="H5"/>
                            <ProgressIndicator 
                                percentValue="{= ${inferenceResults>/summary/avgConfidence} * 100}"
                                displayValue="{inferenceResults>/summary/avgConfidence}"
                                state="{= ${inferenceResults>/summary/avgConfidence} >= 0.8 ? 'Success' : ${inferenceResults>/summary/avgConfidence} >= 0.6 ? 'Warning' : 'Error'}"
                                width="120px"/>
                        </VBox>
                        <VBox>
                            <Title text="Processing Time" level="H5"/>
                            <ObjectNumber 
                                number="{inferenceResults>/summary/processingTime}"
                                unit="ms"
                                state="Success"
                                emphasized="true"/>
                        </VBox>
                    </HBox>
                </Panel>
                
                <!-- Inference Results Table ---->
                <Panel headerText="Generated Inferences">
                    <Table 
                        items="{inferenceResults>/inferences}"
                        mode="MultiSelect"
                        growing="true"
                        growingThreshold="50">
                        <headerToolbar>
                            <Toolbar>
                                <Title text="Inference Results"/>
                                <ToolbarSpacer/>
                                <SearchField 
                                    width="20rem"
                                    placeholder="Search inferences..."
                                    search=".onSearchInferenceResults"/>
                                <Button 
                                    text="Accept Selected"
                                    icon="sap-icon://accept"
                                    press=".onAcceptSelectedInferences"/>
                                <Button 
                                    text="Reject Selected"
                                    icon="sap-icon://decline"
                                    press=".onRejectSelectedInferences"/>
                                <Button 
                                    text="Export"
                                    icon="sap-icon://download"
                                    press=".onExportInferenceResults"/>
                            </Toolbar>
                        </headerToolbar>
                        <columns>
                            <Column>
                                <Text text="Inference"/>
                            </Column>
                            <Column>
                                <Text text="Type"/>
                            </Column>
                            <Column>
                                <Text text="Confidence"/>
                            </Column>
                            <Column>
                                <Text text="Source"/>
                            </Column>
                            <Column>
                                <Text text="Validation"/>
                            </Column>
                            <Column>
                                <Text text="Actions"/>
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem>
                                <cells>
                                    <VBox>
                                        <Text text="{conclusion}" class="sapThemeHighlight-asTextColor"/>
                                        <Text text="{premise}" maxLines="2" class="sapThemeTextSecondary"/>
                                        <Text text="Derived: {derivationTime}" class="sapThemeTextSecondary"/>
                                    </VBox>
                                    <ObjectStatus 
                                        text="{inferenceType}"
                                        state="Information"
                                        icon="{= ${inferenceType} === 'DEDUCTIVE' ? 'sap-icon://decision' : ${inferenceType} === 'INDUCTIVE' ? 'sap-icon://learning-assistant' : 'sap-icon://question-mark'}"/>
                                    <VBox>
                                        <ProgressIndicator 
                                            percentValue="{= ${confidence} * 100}"
                                            displayValue="{confidence}"
                                            state="{= ${confidence} >= 0.8 ? 'Success' : ${confidence} >= 0.6 ? 'Warning' : 'Error'}"
                                            width="100px"/>
                                        <Text text="Certainty: {certaintyLevel}" class="sapThemeTextSecondary"/>
                                    </VBox>
                                    <VBox>
                                        <Text text="{sourceRules} rules"/>
                                        <Text text="{sourceFacts} facts"/>
                                        <Text text="Engine: {reasoningEngine}" class="sapThemeTextSecondary"/>
                                    </VBox>
                                    <ObjectStatus 
                                        text="{validationStatus}"
                                        state="{= ${validationStatus} === 'VERIFIED' ? 'Success' : ${validationStatus} === 'PENDING' ? 'Warning' : ${validationStatus} === 'CONTRADICTED' ? 'Error' : 'None'}"
                                        icon="{= ${validationStatus} === 'VERIFIED' ? 'sap-icon://status-positive' : ${validationStatus} === 'PENDING' ? 'sap-icon://pending' : ${validationStatus} === 'CONTRADICTED' ? 'sap-icon://status-negative' : 'sap-icon://question-mark'}"/>
                                    <HBox>
                                        <Button 
                                            icon="sap-icon://detail-view"
                                            tooltip="View Details"
                                            press=".onViewInferenceResultDetails"/>
                                        <Button 
                                            icon="sap-icon://explain"
                                            tooltip="Explain"
                                            press=".onExplainInferenceResult"/>
                                        <Button 
                                            icon="sap-icon://validate"
                                            tooltip="Validate"
                                            press=".onValidateInferenceResult"/>
                                    </HBox>
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                </Panel>
            </VBox>
        </content>
        
        <beginButton>
            <Button 
                text="Accept All"
                icon="sap-icon://accept"
                press=".onAcceptAllInferences"
                type="Emphasized"/>
        </beginButton>
        
        <endButton>
            <HBox>
                <Button 
                    text="Generate Report"
                    icon="sap-icon://document"
                    press=".onGenerateInferenceReport"
                    class="sapUiMediumMarginEnd"/>
                <Button 
                    text="Close"
                    press=".onCloseInferenceResults"/>
            </HBox>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>