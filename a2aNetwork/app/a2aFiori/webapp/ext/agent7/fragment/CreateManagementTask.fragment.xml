<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form">
    
    <Dialog
        id="createManagementTaskDialog"
        title="{i18n>dialog.createManagementTask}"
        contentWidth="75rem"
        stretch="{device>/system/phone}"
        resizable="true"
        ariaLabelledBy="createTaskTitle">
        
        <customHeader>
            <Bar>
                <contentMiddle>
                    <Title id="createTaskTitle" text="{i18n>dialog.createManagementTask}" level="H2"/>
                </contentMiddle>
            </Bar>
        </customHeader>
        
        <content>
            <IconTabBar expandable="false">
                <items>
                    <!-- Basic Information Tab -->
                    <IconTabFilter text="{i18n>tab.basicInfo}" icon="sap-icon://hint">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="{i18n>field.taskName}" required="true" labelFor="taskNameInput"/>
                                <Input 
                                    id="taskNameInput"
                                    value="{create>/taskName}"
                                    placeholder="{i18n>placeholder.taskName}"
                                    aria-label="{i18n>aria.agentNameInput}"
                                    aria-required="true"
                                    valueState="{create>/taskNameState}"
                                    valueStateText="{create>/taskNameStateText}"
                                    liveChange=".onTaskNameChange"/>
                                
                                <Label text="{i18n>field.description}" labelFor="descriptionInput"/>
                                <TextArea 
                                    id="descriptionInput"
                                    value="{create>/description}"
                                    rows="{= ${device>/system/phone} ? 2 : 3 }"
                                    placeholder="{i18n>placeholder.description}"
                                    aria-label="{i18n>aria.descriptionInput}"/>
                                
                                <Label text="{i18n>field.managedAgent}" required="true" labelFor="managedAgentSelect"/>
                                <Select 
                                    id="managedAgentSelect"
                                    selectedKey="{create>/managedAgent}"
                                    items="{create>/availableAgents}"
                                    aria-label="{i18n>aria.agentTypeSelect}"
                                    aria-required="true"
                                    valueState="{create>/managedAgentState}"
                                    valueStateText="{create>/managedAgentStateText}"
                                    change=".onManagedAgentChange">
                                    <core:Item key="" text="{i18n>placeholder.selectAgent}"/>
                                    <core:ListItem 
                                        key="{create>agentId}"
                                        text="{create>agentName} ({create>agentType})"/>
                                </Select>
                                
                                <Label text="{i18n>field.operationType}" required="true" labelFor="operationTypeSelect"/>
                                <Select 
                                    id="operationTypeSelect"
                                    selectedKey="{create>/operationType}"
                                    aria-label="{i18n>aria.operationTypeSelect}"
                                    aria-required="true"
                                    valueState="{create>/operationTypeState}"
                                    valueStateText="{create>/operationTypeStateText}"
                                    change=".onOperationTypeChange">
                                    <core:Item key="" text="{i18n>placeholder.selectOperation}"/>
                                    <core:Item key="START" text="{i18n>operation.start}"/>
                                    <core:Item key="STOP" text="{i18n>operation.stop}"/>
                                    <core:Item key="RESTART" text="{i18n>operation.restart}"/>
                                    <core:Item key="UPDATE" text="{i18n>operation.update}"/>
                                    <core:Item key="CONFIGURE" text="{i18n>operation.configure}"/>
                                    <core:Item key="REGISTER" text="{i18n>operation.register}"/>
                                    <core:Item key="DEREGISTER" text="{i18n>operation.deregister}"/>
                                    <core:Item key="HEALTH_CHECK" text="{i18n>operation.healthCheck}"/>
                                    <core:Item key="PERFORMANCE_CHECK" text="{i18n>operation.performanceCheck}"/>
                                </Select>
                                
                                <Label text="{i18n>field.priority}" labelFor="prioritySelect"/>
                                <Select 
                                    id="prioritySelect" 
                                    selectedKey="{create>/priority}" 
                                    aria-label="{i18n>aria.prioritySelect}">
                                    <items>
                                        <core:Item key="LOW" text="{i18n>priority.low}"/>
                                        <core:Item key="MEDIUM" text="{i18n>priority.medium}"/>
                                        <core:Item key="HIGH" text="{i18n>priority.high}"/>
                                        <core:Item key="CRITICAL" text="{i18n>priority.critical}"/>
                                    </items>
                                </Select>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Operation Configuration Tab -->
                    <IconTabFilter text="{i18n>tab.operationConfig}" icon="sap-icon://settings">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="{i18n>field.executionMode}"/>
                                <Select selectedKey="{create>/executionMode}">
                                    <items>
                                        <core:Item key="IMMEDIATE" text="{i18n>execution.immediate}"/>
                                        <core:Item key="SCHEDULED" text="{i18n>execution.scheduled}"/>
                                        <core:Item key="CONDITIONAL" text="{i18n>execution.conditional}"/>
                                    </items>
                                </Select>
                                
                                <Label text="{i18n>field.scheduledTime}"/>
                                <DateTimePicker 
                                    value="{create>/scheduledTime}"
                                    visible="{= ${create>/executionMode} === 'SCHEDULED' }"/>
                                
                                <Label text="{i18n>field.timeout}"/>
                                <StepInput 
                                    value="{create>/timeout}"
                                    min="1"
                                    max="1440"
                                    step="5"/>
                                
                                <Label text="{i18n>field.retryAttempts}"/>
                                <StepInput 
                                    value="{create>/retryAttempts}"
                                    min="0"
                                    max="10"
                                    step="1"/>
                                
                                <Label text="{i18n>field.operationOptions}"/>
                                <VBox>
                                    <CheckBox 
                                        text="{i18n>option.forceExecution}"
                                        selected="{create>/forceExecution}"/>
                                    <CheckBox 
                                        text="{i18n>option.createBackup}"
                                        selected="{create>/createBackup}"/>
                                    <CheckBox 
                                        text="{i18n>option.rollbackOnFailure}"
                                        selected="{create>/rollbackOnFailure}"/>
                                    <CheckBox 
                                        text="{i18n>option.notifyOnCompletion}"
                                        selected="{create>/notifyOnCompletion}"/>
                                </VBox>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Parameters Tab -->
                    <IconTabFilter text="{i18n>tab.parameters}" icon="sap-icon://parameter">
                        <VBox>
                            <Toolbar>
                                <Title text="{i18n>field.operationParameters}"/>
                                <ToolbarSpacer/>
                                <Button 
                                    text="{i18n>button.addParameter}"
                                    icon="sap-icon://add"
                                    press=".onAddParameter"/>
                                <Button 
                                    text="{i18n>button.loadTemplate}"
                                    icon="sap-icon://template"
                                    press=".onLoadParameterTemplate"/>
                            </Toolbar>
                            
                            <Table
                                items="{create>/parameters}"
                                mode="Delete"
                                delete=".onDeleteParameter">
                                <columns>
                                    <Column width="30%">
                                        <Text text="{i18n>field.parameterName}"/>
                                    </Column>
                                    <Column width="20%">
                                        <Text text="{i18n>field.type}"/>
                                    </Column>
                                    <Column width="40%">
                                        <Text text="{i18n>field.value}"/>
                                    </Column>
                                    <Column width="10%">
                                        <Text text="{i18n>field.required}"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Input 
                                                value="{create>parameterName}"
                                                placeholder="Parameter name"/>
                                            <Select selectedKey="{create>parameterType}">
                                                <items>
                                                    <core:Item key="STRING" text="String"/>
                                                    <core:Item key="NUMBER" text="Number"/>
                                                    <core:Item key="BOOLEAN" text="Boolean"/>
                                                    <core:Item key="DATE" text="Date"/>
                                                    <core:Item key="JSON" text="JSON"/>
                                                </items>
                                            </Select>
                                            <Input 
                                                value="{create>parameterValue}"
                                                placeholder="Parameter value"/>
                                            <CheckBox selected="{create>required}"/>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </VBox>
                    </IconTabFilter>
                    
                    <!-- Dependencies Tab -->
                    <IconTabFilter text="Dependencies" icon="sap-icon://chain-link">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="Dependency Type"/>
                                <Select selectedKey="{create>/dependencyType}">
                                    <items>
                                        <core:Item key="NONE" text="No Dependencies"/>
                                        <core:Item key="AGENT_STATUS" text="Agent Status"/>
                                        <core:Item key="TASK_COMPLETION" text="Task Completion"/>
                                        <core:Item key="RESOURCE_AVAILABILITY" text="Resource Availability"/>
                                        <core:Item key="TIME_WINDOW" text="Time Window"/>
                                    </items>
                                </Select>
                                
                                <Label text="Required Agent Status"/>
                                <Select 
                                    selectedKey="{create>/requiredAgentStatus}"
                                    visible="{= ${create>/dependencyType} === 'AGENT_STATUS' }">
                                    <items>
                                        <core:Item key="ONLINE" text="Online"/>
                                        <core:Item key="IDLE" text="Idle"/>
                                        <core:Item key="HEALTHY" text="Healthy"/>
                                    </items>
                                </Select>
                                
                                <Label text="Prerequisite Tasks"/>
                                <MultiInput 
                                    value="{create>/prerequisiteTasks}"
                                    visible="{= ${create>/dependencyType} === 'TASK_COMPLETION' }"
                                    placeholder="Enter task IDs"/>
                                
                                <Label text="Resource Requirements"/>
                                <VBox visible="{= ${create>/dependencyType} === 'RESOURCE_AVAILABILITY' }">
                                    <HBox>
                                        <Label text="Min CPU Available (%):"/>
                                        <Slider 
                                            value="{create>/minCpuAvailable}"
                                            min="0"
                                            max="100"
                                            step="10"
                                            width="150px"/>
                                    </HBox>
                                    <HBox>
                                        <Label text="Min Memory Available (%):"/>
                                        <Slider 
                                            value="{create>/minMemoryAvailable}"
                                            min="0"
                                            max="100"
                                            step="10"
                                            width="150px"/>
                                    </HBox>
                                </VBox>
                                
                                <Label text="Execution Time Window"/>
                                <VBox visible="{= ${create>/dependencyType} === 'TIME_WINDOW' }">
                                    <HBox>
                                        <Label text="Start Time:"/>
                                        <TimePicker value="{create>/timeWindowStart}"/>
                                    </HBox>
                                    <HBox>
                                        <Label text="End Time:"/>
                                        <TimePicker value="{create>/timeWindowEnd}"/>
                                    </HBox>
                                </VBox>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Monitoring Tab -->
                    <IconTabFilter text="Monitoring" icon="sap-icon://monitor">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="Monitoring Level"/>
                                <Select selectedKey="{create>/monitoringLevel}">
                                    <items>
                                        <core:Item key="BASIC" text="Basic (Status Only)"/>
                                        <core:Item key="DETAILED" text="Detailed (With Metrics)"/>
                                        <core:Item key="VERBOSE" text="Verbose (Full Logging)"/>
                                    </items>
                                </Select>
                                
                                <Label text="Health Check Interval"/>
                                <StepInput 
                                    value="{create>/healthCheckInterval}"
                                    min="5"
                                    max="300"
                                    step="5"
                                    description="seconds"/>
                                
                                <Label text="Performance Monitoring"/>
                                <VBox>
                                    <CheckBox 
                                        text="Monitor CPU usage"
                                        selected="{create>/monitorCpu}"/>
                                    <CheckBox 
                                        text="Monitor memory usage"
                                        selected="{create>/monitorMemory}"/>
                                    <CheckBox 
                                        text="Monitor network latency"
                                        selected="{create>/monitorNetwork}"/>
                                    <CheckBox 
                                        text="Monitor response times"
                                        selected="{create>/monitorResponse}"/>
                                </VBox>
                                
                                <Label text="Alert Thresholds"/>
                                <VBox>
                                    <HBox>
                                        <Label text="CPU Alert Threshold (%):"/>
                                        <Slider 
                                            value="{create>/cpuAlertThreshold}"
                                            min="50"
                                            max="100"
                                            step="5"
                                            width="150px"/>
                                    </HBox>
                                    <HBox>
                                        <Label text="Memory Alert Threshold (%):"/>
                                        <Slider 
                                            value="{create>/memoryAlertThreshold}"
                                            min="50"
                                            max="100"
                                            step="5"
                                            width="150px"/>
                                    </HBox>
                                    <HBox>
                                        <Label text="Response Time Alert (ms):"/>
                                        <StepInput 
                                            value="{create>/responseTimeAlert}"
                                            min="100"
                                            max="10000"
                                            step="100"/>
                                    </HBox>
                                </VBox>
                                
                                <Label text="Notification Settings"/>
                                <VBox>
                                    <CheckBox 
                                        text="Email notifications"
                                        selected="{create>/emailNotifications}"/>
                                    <CheckBox 
                                        text="SMS notifications for critical alerts"
                                        selected="{create>/smsNotifications}"/>
                                    <CheckBox 
                                        text="Slack notifications"
                                        selected="{create>/slackNotifications}"/>
                                </VBox>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </content>
        
        <beginButton>
            <Button 
                text="{i18n>button.cancel}"
                press=".onCancelCreateTask"
                ariaLabel="{i18n>aria.closeDialog}"/>
        </beginButton>
        
        <endButton>
            <Button 
                text="{i18n>button.create}"
                type="Emphasized"
                press=".onConfirmCreateTask"
                enabled="{= ${create>/taskName} &amp;&amp; ${create>/managedAgent} &amp;&amp; ${create>/operationType} }"
                ariaLabel="{i18n>aria.saveConfiguration}"
                tooltip="{i18n>tooltip.create}"/>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>