<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
    xmlns:l="sap.ui.layout">
    
    <Dialog
        id="createVectorTaskDialog"
        title="{i18n>title.createVectorTask}"
        contentWidth="75rem"
        contentHeight="auto"
        resizable="true"
        draggable="true"
        stretch="{device>/system/phone}"
        ariaLabelledBy="createVectorTaskTitle"
        ariaDescribedBy="createVectorTaskHelp"
        class="sapUiResponsiveContentPadding"
        afterOpen=".onDialogAfterOpen"
        afterClose=".onDialogAfterClose">
        
        <core:InvisibleText id="createVectorTaskTitle" text="Create Vector Processing Task Dialog"/>
        <core:InvisibleText id="createVectorTaskHelp" text="Configure a new vector processing task by specifying data source, embedding model, vector database, and processing parameters across multiple tabs."/>
        
        <content>
            <IconTabBar 
                id="vectorTaskTabBar"
                expandable="false"
                stretchContentHeight="true"
                ariaLabelledBy="vectorTaskTabBarLabel">
                <core:InvisibleText id="vectorTaskTabBarLabel" text="Vector task configuration sections: Basic Information, Embedding Model, Vector Database, and Processing Options"/>
                
                <items>
                    <!-- Basic Configuration Tab -->
                    <IconTabFilter text="{i18n>tab.basicInfo}" icon="sap-icon://hint" ariaDescribedBy="basicInfoTabHelp">
                        <core:InvisibleText id="basicInfoTabHelp" text="Basic task information including name, description, data source, and data type"/>
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="4"
                            labelSpanL="4"
                            labelSpanM="12"
                            labelSpanS="12"
                            adjustLabelSpan="false"
                            emptySpanXL="0"
                            emptySpanL="0"
                            emptySpanM="0"
                            columnsXL="2"
                            columnsL="1"
                            columnsM="1"
                            class="sapUiResponsiveMargin">
                            <form:content>
                                <Label text="{i18n>taskName}" required="true" labelFor="taskNameInput"/>
                                <Input 
                                    id="taskNameInput"
                                    value="{create>/taskName}"
                                    placeholder="{i18n>placeholder.taskName}"
                                    maxLength="100"
                                    liveChange=".onTaskNameChange"
                                    required="true"
                                    valueState="{create>/taskNameState}"
                                    valueStateText="{create>/taskNameStateText}"
                                    ariaDescribedBy="taskNameHelp"
                                    class="sapUiMediumMarginBottom"/>
                                <core:InvisibleText id="taskNameHelp" text="Required field. Enter a unique name for this vector processing task using alphanumeric characters, spaces, hyphens, underscores, or periods only."/>
                                
                                <Label text="{i18n>description}" labelFor="descriptionInput"/>
                                <TextArea 
                                    id="descriptionInput"
                                    value="{create>/description}"
                                    rows="3"
                                    growing="true"
                                    growingMaxLines="5"
                                    placeholder="{i18n>placeholder.description}"
                                    maxLength="1000"
                                    ariaDescribedBy="descriptionHelp"
                                    class="sapUiMediumMarginBottom"/>
                                <core:InvisibleText id="descriptionHelp" text="Optional field. Provide additional details about what this vector processing task will accomplish and any special requirements."/>
                                
                                <Label text="{i18n>dataSource}" required="true" labelFor="dataSourceInput"/>
                                <Input 
                                    id="dataSourceInput"
                                    value="{create>/dataSource}"
                                    placeholder="{i18n>placeholder.dataSource}"
                                    showValueHelp="true"
                                    valueHelpRequest=".onSelectDataSource"
                                    maxLength="500"
                                    liveChange=".onDataSourceChange"
                                    required="true"
                                    valueState="{create>/dataSourceState}"
                                    valueStateText="{create>/dataSourceStateText}"
                                    ariaDescribedBy="dataSourceHelp"
                                    class="sapUiMediumMarginBottom"/>
                                <core:InvisibleText id="dataSourceHelp" text="Required field. Specify the path to your data source. Click the help button to browse available data sources."/>
                                
                                <Label text="{i18n>dataType}" required="true" labelFor="dataTypeSelect"/>
                                <Select 
                                    id="dataTypeSelect"
                                    selectedKey="{create>/dataType}"
                                    change=".onDataTypeChange"
                                    required="true"
                                    valueState="{create>/dataTypeState}"
                                    valueStateText="{create>/dataTypeStateText}"
                                    ariaDescribedBy="dataTypeHelp"
                                    class="sapUiMediumMarginBottom">
                                <core:InvisibleText id="dataTypeHelp" text="Required field. Select the type of data you want to process for vector embeddings."/>
                                    <items>
                                        <core:Item key="" text="{i18n>placeholder.selectDataType}"/>
                                        <core:Item key="TEXT" text="{i18n>dataType.text}" icon="sap-icon://document-text"/>
                                        <core:Item key="CODE" text="{i18n>dataType.code}" icon="sap-icon://syntax"/>
                                        <core:Item key="STRUCTURED" text="{i18n>dataType.structured}" icon="sap-icon://table-view"/>
                                        <core:Item key="IMAGE" text="{i18n>dataType.image}" icon="sap-icon://picture"/>
                                        <core:Item key="AUDIO" text="{i18n>dataType.audio}" icon="sap-icon://microphone"/>
                                        <core:Item key="MULTIMODAL" text="{i18n>dataType.multimodal}" icon="sap-icon://multiple-pie-chart"/>
                                    </items>
                                </Select>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Embedding Configuration Tab -->
                    <IconTabFilter text="Embedding Model" icon="sap-icon://artificial-intelligence">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="Model Provider"/>
                                <Select 
                                    selectedKey="{create>/modelProvider}"
                                    change=".onModelProviderChange">
                                    <items>
                                        <core:Item key="OPENAI" text="OpenAI"/>
                                        <core:Item key="COHERE" text="Cohere"/>
                                        <core:Item key="HUGGINGFACE" text="Hugging Face"/>
                                        <core:Item key="SENTENCE_TRANSFORMERS" text="Sentence Transformers"/>
                                        <core:Item key="CUSTOM" text="Custom Model"/>
                                    </items>
                                </Select>
                                
                                <Label text="Embedding Model"/>
                                <Select selectedKey="{create>/embeddingModel}">
                                    <items>
                                        <core:Item key="text-embedding-ada-002" text="text-embedding-ada-002 (OpenAI)"/>
                                        <core:Item key="text-embedding-3-small" text="text-embedding-3-small (OpenAI)"/>
                                        <core:Item key="text-embedding-3-large" text="text-embedding-3-large (OpenAI)"/>
                                        <core:Item key="embed-english-v3.0" text="embed-english-v3.0 (Cohere)"/>
                                        <core:Item key="all-MiniLM-L6-v2" text="all-MiniLM-L6-v2 (Sentence Transformers)"/>
                                        <core:Item key="all-mpnet-base-v2" text="all-mpnet-base-v2 (Sentence Transformers)"/>
                                    </items>
                                </Select>
                                
                                <Label text="Output Dimensions"/>
                                <Input 
                                    value="{create>/dimensions}"
                                    type="Number"
                                    editable="false"
                                    description="{path: 'create>/dimensionsDescription', formatter: '.formatSecureText'}"/>
                                
                                <Label text="Chunk Size (tokens)"/>
                                <Slider 
                                    value="{create>/chunkSize}"
                                    min="128"
                                    max="2048"
                                    step="128"
                                    enableTickmarks="true"
                                    inputsAsTooltips="true"/>
                                
                                <Label text="Chunk Overlap (tokens)"/>
                                <Slider 
                                    value="{create>/chunkOverlap}"
                                    min="0"
                                    max="200"
                                    step="10"
                                    enableTickmarks="true"
                                    inputsAsTooltips="true"/>
                                
                                <Label text="Normalization"/>
                                <CheckBox 
                                    text="Normalize embeddings to unit length"
                                    selected="{create>/normalization}"/>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Vector Database Tab -->
                    <IconTabFilter text="Vector Database" icon="sap-icon://database">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="Vector Database"/>
                                <Select 
                                    selectedKey="{create>/vectorDatabase}"
                                    change=".onVectorDatabaseChange">
                                    <items>
                                        <core:Item key="PINECONE" text="Pinecone"/>
                                        <core:Item key="WEAVIATE" text="Weaviate"/>
                                        <core:Item key="QDRANT" text="Qdrant"/>
                                        <core:Item key="MILVUS" text="Milvus"/>
                                        <core:Item key="CHROMA" text="Chroma"/>
                                        <core:Item key="FAISS" text="FAISS (Local)"/>
                                    </items>
                                </Select>
                                
                                <Label text="Index Type"/>
                                <Select selectedKey="{create>/indexType}">
                                    <items>
                                        <core:Item key="HNSW" text="HNSW (Hierarchical NSW)"/>
                                        <core:Item key="IVF" text="IVF (Inverted File)"/>
                                        <core:Item key="FLAT" text="Flat (Exact Search)"/>
                                        <core:Item key="LSH" text="LSH (Locality Sensitive Hashing)"/>
                                    </items>
                                </Select>
                                
                                <Label text="Distance Metric"/>
                                <Select selectedKey="{create>/distanceMetric}">
                                    <items>
                                        <core:Item key="COSINE" text="Cosine Similarity"/>
                                        <core:Item key="EUCLIDEAN" text="Euclidean Distance"/>
                                        <core:Item key="DOT_PRODUCT" text="Dot Product"/>
                                        <core:Item key="MANHATTAN" text="Manhattan Distance"/>
                                    </items>
                                </Select>
                                
                                <Label text="Collection Name" labelFor="collectionNameInput"/>
                                <Input 
                                    id="collectionNameInput"
                                    value="{create>/collectionName}"
                                    placeholder="Enter collection name"
                                    maxLength="50"
                                    change=".onCollectionNameChange"
                                    ariaLabel="Vector collection name"/>
                                
                                <Label text="Metadata Schema"/>
                                <TextArea
                                    value="{create>/metadataSchema}"
                                    rows="4"
                                    placeholder='{"title": "string", "category": "string", "timestamp": "datetime"}'/>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                    
                    <!-- Processing Options Tab -->
                    <IconTabFilter text="Processing" icon="sap-icon://settings">
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout">
                            <form:content>
                                <Label text="Batch Size"/>
                                <Slider 
                                    value="{create>/batchSize}"
                                    min="1"
                                    max="100"
                                    step="1"
                                    enableTickmarks="true"
                                    inputsAsTooltips="true"/>
                                
                                <Label text="Parallel Processing"/>
                                <CheckBox 
                                    text="Enable parallel processing"
                                    selected="{create>/parallelProcessing}"/>
                                
                                <Label text="GPU Acceleration"/>
                                <CheckBox 
                                    text="Use GPU if available"
                                    selected="{create>/useGPU}"/>
                                
                                <Label text="Error Handling"/>
                                <RadioButtonGroup selectedIndex="{create>/errorHandling}">
                                    <RadioButton text="Stop on first error"/>
                                    <RadioButton text="Skip errors and continue"/>
                                    <RadioButton text="Retry failed items"/>
                                </RadioButtonGroup>
                                
                                <Label text="Progress Monitoring"/>
                                <CheckBox 
                                    text="Enable real-time progress updates"
                                    selected="{create>/progressMonitoring}"/>
                                
                                <Label text="Incremental Updates"/>
                                <CheckBox 
                                    text="Only process new/changed documents"
                                    selected="{create>/incrementalUpdates}"/>
                            </form:content>
                        </form:SimpleForm>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </content>
        
        <beginButton>
            <Button 
                text="{i18n>button.cancel}"
                press=".onCancelCreateTask"/>
        </beginButton>
        
        <endButton>
            <Button 
                text="{i18n>button.create}"
                type="Emphasized"
                press=".onConfirmCreateTask"
                enabled="{= ${create>/taskName} &amp;&amp; ${create>/dataSource} &amp;&amp; ${create>/dataType} &amp;&amp; ${create>/isValid} }"/>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>