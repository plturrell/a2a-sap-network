<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form">
    
    <Dialog
        id="similaritySearchDialog"
        title="Vector Similarity Search"
        contentWidth="70%"
        contentHeight="60%"
        resizable="true"
        draggable="true"
        ariaLabel="Vector similarity search dialog">
        
        <content>
            <form:SimpleForm
                editable="true"
                layout="ResponsiveGridLayout"
                labelSpanXL="3"
                labelSpanL="3"
                labelSpanM="12"
                labelSpanS="12"
                adjustLabelSpan="false"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                
                <form:content>
                    <Label text="Query Type" required="true" labelFor="queryTypeGroup"/>
                    <RadioButtonGroup 
                        id="queryTypeGroup"
                        selectedIndex="{similarity>/queryType}"
                        ariaLabel="Select search query type">
                        <RadioButton text="Text Query"/>
                        <RadioButton text="Vector Query"/>
                    </RadioButtonGroup>
                    
                    <!-- Text Query Section -->
                    <VBox visible="{= ${similarity>/queryType} === 0 }">
                        <Label text="Search Query" required="true" labelFor="textQueryInput"/>
                        <TextArea 
                            id="textQueryInput"
                            value="{similarity>/query}"
                            rows="3"
                            placeholder="Enter your search query..."
                            maxLength="1000"
                            liveChange=".onQueryChange"
                            ariaLabel="Text search query input"/>
                    </VBox>
                    
                    <!-- Vector Query Section -->
                    <VBox visible="{= ${similarity>/queryType} === 1 }">
                        <Label text="Vector Input" labelFor="vectorQueryInput"/>
                        <TextArea 
                            id="vectorQueryInput"
                            value="{similarity>/vectorQuery}"
                            rows="4"
                            placeholder="Enter vector as comma-separated values: 0.1, 0.2, -0.3, ..."
                            maxLength="10000"
                            liveChange=".onVectorQueryChange"
                            ariaLabel="Vector coordinates input"/>
                        <Text text="Expected dimensions: {similarity>/expectedDimensions}"/>
                    </VBox>
                    
                    <Label text="Collection" required="true" labelFor="collectionSelect"/>
                    <Select 
                        id="collectionSelect"
                        selectedKey="{similarity>/collection}"
                        change=".onCollectionChange"
                        ariaLabel="Select vector collection">
                        <items>
                            <core:Item key="" text="Select collection..."/>
                            <core:Item key="{>name}" text="{path: '>name', formatter: '.formatSecureText'}"/>
                        </items>
                    </Select>
                    
                    <Label text="Search Parameters"/>
                    <VBox>
                        <HBox>
                            <Label text="Top K Results:" width="120px" labelFor="topKInput"/>
                            <Input 
                                id="topKInput"
                                value="{similarity>/topK}"
                                type="Number"
                                width="80px"
                                ariaLabel="Number of results to return"/>
                        </HBox>
                    </VBox>
                    
                    <Label text="Output Options"/>
                    <VBox>
                        <CheckBox 
                            text="Include metadata"
                            selected="{similarity>/includeMetadata}"
                            ariaLabel="Include result metadata"/>
                        <CheckBox 
                            text="Include distances"
                            selected="{similarity>/includeDistance}"
                            ariaLabel="Include distance scores"/>
                    </VBox>
                    
                    <Label text="Filters (Optional)" labelFor="filterSection"/>
                    <VBox id="filterSection">
                        <Text text="{= ${similarity>/filters} ? 'Filters applied' : 'No filters applied' }" 
                              class="sapUiTinyMarginBottom"/>
                    </VBox>
                </form:content>
            </form:SimpleForm>
            
            <!-- Search validation Messages -->
            <MessageStrip 
                text="Validation enabled for secure similarity search"
                type="Information"
                showIcon="true"
                class="sapUiMediumMarginTop"/>
        </content>
        
        <beginButton>
            <Button 
                text="Cancel"
                press=".onCancelSimilaritySearch"
                ariaLabel="Cancel similarity search"/>
        </beginButton>
        
        <endButton>
            <Button 
                text="Search"
                type="Emphasized"
                press=".onExecuteSimilaritySearch"
                enabled="{= (${similarity>/query} || ${similarity>/vectorQuery}) && ${similarity>/collection} }"
                ariaLabel="Execute similarity search"/>
        </endButton>
        
    </Dialog>
    
</core:FragmentDefinition>