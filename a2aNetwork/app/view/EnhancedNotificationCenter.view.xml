<mvc:View
    controllerName="a2a.network.controller.EnhancedNotificationCenter"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:tnt="sap.tnt"
    xmlns:micro="sap.suite.ui.microchart">
    
    <Page title="Enhanced Notification Center" showNavButton="true" navButtonPress="onNavBack" class="notificationCenterPage">
        <customHeader>
            <Bar class="sapUiResponsiveContentPadding">
                <contentLeft>
                    <Button icon="sap-icon://nav-back" press="onNavBack"/>
                    <Title text="A2A Notification Center" class="sapUiMediumMarginBegin"/>
                </contentLeft>
                <contentMiddle>
                    <!-- Connection Status Indicator -->
                    <HBox alignItems="Center" class="connectionStatusBox">
                        <core:Icon 
                            src="{path: 'notificationModel>/connectionStatus', formatter: '.formatConnectionIcon'}" 
                            color="{path: 'notificationModel>/connectionStatus', formatter: '.formatConnectionColor'}"
                            class="sapUiTinyMarginEnd"/>
                        <Text text="{path: 'notificationModel>/connectionStatus', formatter: '.formatConnectionText'}" 
                              class="connectionStatusText"/>
                        <Text text="{notificationModel>/lastUpdated}" class="sapUiTinyMarginBegin lastUpdateText"/>
                    </HBox>
                </contentMiddle>
                <contentRight>
                    <Button 
                        icon="sap-icon://bell" 
                        text="{notificationModel>/stats/unread}"
                        type="{= ${notificationModel>/stats/unread} > 0 ? 'Emphasized' : 'Default'}"
                        press="onToggleUnreadOnly"
                        tooltip="Show only unread notifications"
                        class="unreadCountButton"/>
                    <Button 
                        icon="sap-icon://action-settings" 
                        press="onOpenSettings"
                        tooltip="Notification Settings"
                        type="Transparent"/>
                    <Button 
                        icon="sap-icon://refresh" 
                        press="onRefresh"
                        tooltip="Refresh Notifications"
                        type="Transparent"
                        enabled="{= ${notificationModel>/connectionStatus} !== 'connecting'}"/>
                </contentRight>
            </Bar>
        </customHeader>

        <content>
            <l:Splitter orientation="Horizontal" class="sapUiContentPadding">
                
                <!-- Left Panel - Filters and Stats -->
                <l:PaneContainer>
                    <l:SplitPane requiredParentWidth="400">
                        <VBox class="leftPanel">
                            
                            <!-- Real-time Statistics Dashboard -->
                            <Panel headerText="Live Statistics" expandable="false" class="sapUiResponsiveMargin statsPanel">
                                <content>
                                    <l:Grid defaultSpan="XL6 L6 M12 S12" class="sapUiResponsiveContentPadding">
                                        
                                        <!-- Total Notifications Card -->
                                        <GenericTile 
                                            class="sapUiTinyMargin statsTile totalTile"
                                            header="Total Notifications"
                                            subheader="All time"
                                            press="onShowAllNotifications">
                                            <tileContent>
                                                <TileContent>
                                                    <content>
                                                        <NumericContent 
                                                            value="{notificationModel>/stats/total}"
                                                            icon="sap-icon://documents"
                                                            withMargin="false"/>
                                                    </content>
                                                </TileContent>
                                            </tileContent>
                                        </GenericTile>
                                        
                                        <!-- Unread Notifications Card -->
                                        <GenericTile 
                                            class="sapUiTinyMargin statsTile unreadTile"
                                            header="Unread"
                                            subheader="Needs attention"
                                            state="{= ${notificationModel>/stats/unread} > 0 ? 'Failed' : 'Loaded'}"
                                            press="onShowUnreadNotifications">
                                            <tileContent>
                                                <TileContent>
                                                    <content>
                                                        <NumericContent 
                                                            value="{notificationModel>/stats/unread}"
                                                            state="{= ${notificationModel>/stats/unread} > 0 ? 'Error' : 'Good'}"
                                                            icon="sap-icon://bell"
                                                            withMargin="false"/>
                                                    </content>
                                                </TileContent>
                                            </tileContent>
                                        </GenericTile>
                                        
                                        <!-- Critical Notifications Card -->
                                        <GenericTile 
                                            class="sapUiTinyMargin statsTile criticalTile"
                                            header="Critical"
                                            subheader="High priority"
                                            state="{= ${notificationModel>/stats/byPriority/critical} > 0 ? 'Failed' : 'Loaded'}"
                                            press="onShowCriticalNotifications">
                                            <tileContent>
                                                <TileContent>
                                                    <content>
                                                        <NumericContent 
                                                            value="{notificationModel>/stats/byPriority/critical}"
                                                            state="{= ${notificationModel>/stats/byPriority/critical} > 0 ? 'Critical' : 'Good'}"
                                                            icon="sap-icon://alert"
                                                            withMargin="false"/>
                                                    </content>
                                                </TileContent>
                                            </tileContent>
                                        </GenericTile>
                                        
                                        <!-- Agent Messages Card -->
                                        <GenericTile 
                                            class="sapUiTinyMargin statsTile agentTile"
                                            header="Agent Messages"
                                            subheader="A2A communications"
                                            press="onShowAgentMessages">
                                            <tileContent>
                                                <TileContent>
                                                    <content>
                                                        <NumericContent 
                                                            value="{notificationModel>/stats/byCategory/agent_message}"
                                                            icon="sap-icon://collaborate"
                                                            withMargin="false"/>
                                                    </content>
                                                </TileContent>
                                            </tileContent>
                                        </GenericTile>
                                        
                                    </l:Grid>
                                </content>
                            </Panel>

                            <!-- Category Breakdown Chart -->
                            <Panel headerText="Notification Categories" expandable="true" expanded="true" class="sapUiResponsiveMargin categoryPanel">
                                <content>
                                    <micro:DonutChart 
                                        size="M"
                                        segments="{notificationModel>/stats/categoryChart}"
                                        class="sapUiContentPadding">
                                        <micro:DonutChartSegment 
                                            displayedValue="{count}"
                                            value="{count}"
                                            color="{color}"
                                            title="{category}"/>
                                    </micro:DonutChart>
                                </content>
                            </Panel>

                            <!-- Advanced Filters -->
                            <Panel headerText="Smart Filters" expandable="true" expanded="false" class="sapUiResponsiveMargin filtersPanel">
                                <content>
                                    <VBox class="sapUiContentPadding">
                                        
                                        <!-- Quick Filter Buttons -->
                                        <HBox class="sapUiTinyMarginBottom quickFilters" wrap="Wrap">
                                            <ToggleButton 
                                                text="Unread Only" 
                                                icon="sap-icon://bell"
                                                pressed="{filterModel>/unreadOnly}"
                                                press="onToggleUnreadFilter"
                                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                                            <ToggleButton 
                                                text="High Priority" 
                                                icon="sap-icon://alert"
                                                pressed="{filterModel>/highPriorityOnly}"
                                                press="onToggleHighPriorityFilter"
                                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                                            <ToggleButton 
                                                text="Agent Messages" 
                                                icon="sap-icon://collaborate"
                                                pressed="{filterModel>/agentMessagesOnly}"
                                                press="onToggleAgentMessagesFilter"
                                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                                            <ToggleButton 
                                                text="Security Alerts" 
                                                icon="sap-icon://shield"
                                                pressed="{filterModel>/securityOnly}"
                                                press="onToggleSecurityFilter"
                                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                                        </HBox>
                                        
                                        <!-- Detailed Filters -->
                                        <f:SimpleForm 
                                            editable="true" 
                                            layout="ResponsiveGridLayout"
                                            labelSpanXL="4" labelSpanL="4" labelSpanM="4" labelSpanS="12"
                                            emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0"
                                            columnsXL="1" columnsL="1" columnsM="1"
                                            class="filtersForm">
                                            
                                            <Label text="Time Range:"/>
                                            <ComboBox selectedKey="{filterModel>/timeRange}" selectionChange="onTimeRangeChange">
                                                <core:Item key="1h" text="Last Hour"/>
                                                <core:Item key="24h" text="Last 24 Hours"/>
                                                <core:Item key="7d" text="Last 7 Days"/>
                                                <core:Item key="30d" text="Last 30 Days"/>
                                                <core:Item key="all" text="All Time"/>
                                            </ComboBox>
                                            
                                            <Label text="Source Agent:"/>
                                            <MultiComboBox 
                                                selectedKeys="{filterModel>/sourceAgents}"
                                                items="{notificationModel>/availableAgents}"
                                                selectionFinish="onSourceAgentFilter">
                                                <core:Item key="{agentId}" text="{name} ({agentId})"/>
                                            </MultiComboBox>
                                            
                                            <Label text="Message Type:"/>
                                            <ComboBox selectedKey="{filterModel>/messageType}" selectionChange="onMessageTypeFilter">
                                                <core:Item key="" text="All Types"/>
                                                <core:Item key="request" text="Agent Requests"/>
                                                <core:Item key="response" text="Agent Responses"/>
                                                <core:Item key="notification" text="Agent Notifications"/>
                                                <core:Item key="alert" text="System Alerts"/>
                                                <core:Item key="approval" text="Workflow Approvals"/>
                                            </ComboBox>
                                            
                                            <Label text="Search:"/>
                                            <SearchField 
                                                value="{filterModel>/searchText}"
                                                search="onSearchNotifications"
                                                placeholder="Search notifications..."
                                                showSearchButton="true"/>
                                                
                                        </f:SimpleForm>
                                        
                                    </VBox>
                                </content>
                                <actions>
                                    <Button text="Reset Filters" press="onResetFilters" type="Transparent"/>
                                    <Button text="Save Filter" press="onSaveFilter" type="Emphasized"/>
                                </actions>
                            </Panel>
                            
                        </VBox>
                    </l:SplitPane>
                </l:PaneContainer>
                
                <!-- Right Panel - Notifications List -->
                <l:PaneContainer>
                    <l:SplitPane>
                        <VBox class="rightPanel">
                            
                            <!-- Notifications Header -->
                            <Toolbar class="notificationsToolbar">
                                <Title text="Notifications ({notificationModel>/filteredCount})" level="H2"/>
                                <ToolbarSpacer/>
                                <Label text="Sort by:"/>
                                <ComboBox selectedKey="{sortModel>/field}" selectionChange="onSortChange" class="sapUiTinyMarginBegin">
                                    <core:Item key="createdAt" text="Date"/>
                                    <core:Item key="priority" text="Priority"/>
                                    <core:Item key="status" text="Status"/>
                                    <core:Item key="source" text="Source"/>
                                </ComboBox>
                                <Button 
                                    icon="{= ${sortModel>/ascending} ? 'sap-icon://sort-ascending' : 'sap-icon://sort-descending'}"
                                    press="onToggleSortDirection"
                                    tooltip="Toggle sort direction"
                                    type="Transparent"/>
                                <Button text="Mark All Read" press="onMarkAllRead" type="Emphasized"/>
                            </Toolbar>
                            
                            <!-- Enhanced Notifications List -->
                            <List 
                                id="enhancedNotificationList"
                                items="{
                                    path: 'notificationModel>/filteredNotifications',
                                    sorter: {
                                        path: '{sortModel>/field}',
                                        descending: '{= !${sortModel>/ascending}}'
                                    }
                                }"
                                mode="SingleSelectMaster"
                                selectionChange="onNotificationSelect"
                                noDataText="No notifications match current filters"
                                showSeparators="All"
                                class="enhancedNotificationsList"
                                growing="true"
                                growingThreshold="20"
                                growingTriggerText="Load More Notifications">
                                
                                <CustomListItem press="onNotificationPress" class="notificationListItem">
                                    <content>
                                        <VBox class="sapUiMediumMargin notificationCard">
                                            
                                            <!-- Enhanced Header Row -->
                                            <HBox justifyContent="SpaceBetween" alignItems="Center" class="notificationHeader">
                                                <HBox alignItems="Center" class="notificationHeaderLeft">
                                                    
                                                    <!-- Enhanced Priority/Type Icon with Animation -->
                                                    <core:Icon 
                                                        src="{parts: ['notificationModel>type', 'notificationModel>priority', 'notificationModel>category'], formatter: '.formatEnhancedNotificationIcon'}" 
                                                        color="{parts: ['notificationModel>priority', 'notificationModel>type'], formatter: '.formatEnhancedNotificationColor'}"
                                                        class="notificationTypeIcon"
                                                        size="1.5rem"/>
                                                    
                                                    <!-- Source Agent Avatar -->
                                                    <Avatar 
                                                        src="{parts: ['notificationModel>sourceAgent'], formatter: '.formatAgentAvatar'}"
                                                        initials="{parts: ['notificationModel>sourceAgent'], formatter: '.formatAgentInitials'}"
                                                        backgroundColor="{parts: ['notificationModel>sourceAgent'], formatter: '.formatAgentColor'}"
                                                        class="sourceAgentAvatar sapUiTinyMarginBegin"/>
                                                    
                                                    <VBox class="sapUiMediumMarginBegin">
                                                        <!-- Enhanced Title with Formatting -->
                                                        <Title 
                                                            text="{notificationModel>title}" 
                                                            level="H4"
                                                            class="notificationTitle {= ${notificationModel>status} === 'unread' ? 'unreadTitle' : 'readTitle'}"
                                                            maxLines="1"/>
                                                        
                                                        <!-- Source Information -->
                                                        <HBox alignItems="Center" class="sourceInfo">
                                                            <Text text="From:" class="sourceLabel"/>
                                                            <Link 
                                                                text="{parts: ['notificationModel>sourceAgent', 'notificationModel>source'], formatter: '.formatSourceDisplay'}"
                                                                press="onSourcePress"
                                                                class="sourceLink sapUiTinyMarginBegin"/>
                                                            <Text text="•" class="separator"/>
                                                            <ObjectStatus 
                                                                text="{parts: ['notificationModel>category', 'notificationModel>messageType'], formatter: '.formatCategoryDisplay'}"
                                                                state="{parts: ['notificationModel>category'], formatter: '.formatCategoryState'}"
                                                                class="categoryStatus"/>
                                                        </HBox>
                                                    </VBox>
                                                </HBox>
                                                
                                                <!-- Enhanced Action Buttons -->
                                                <HBox class="notificationActions" alignItems="Center">
                                                    
                                                    <!-- Time Display -->
                                                    <VBox alignItems="End" class="timeDisplay">
                                                        <Text 
                                                            text="{path: 'notificationModel>createdAt', formatter: '.formatRelativeTime'}" 
                                                            class="relativeTime"/>
                                                        <Text 
                                                            text="{path: 'notificationModel>createdAt', formatter: '.formatAbsoluteTime'}" 
                                                            class="absoluteTime"/>
                                                    </VBox>
                                                    
                                                    <!-- Priority Badge -->
                                                    <ObjectStatus 
                                                        text="{notificationModel>priority}"
                                                        state="{path: 'notificationModel>priority', formatter: '.formatPriorityState'}"
                                                        icon="{path: 'notificationModel>priority', formatter: '.formatPriorityIcon'}"
                                                        class="priorityBadge sapUiMediumMarginBegin"/>
                                                    
                                                    <!-- Action Buttons -->
                                                    <HBox class="actionButtons sapUiMediumMarginBegin">
                                                        
                                                        <!-- A2A Message Actions -->
                                                        <Button 
                                                            icon="sap-icon://message-success"
                                                            type="Transparent"
                                                            tooltip="Reply to Agent"
                                                            press="onReplyToAgent"
                                                            visible="{= ${notificationModel>category} === 'agent_message' && ${notificationModel>messageType} === 'request'}"
                                                            class="replyButton"/>
                                                        
                                                        <!-- Approval Actions -->
                                                        <Button 
                                                            text="Approve"
                                                            icon="sap-icon://accept"
                                                            type="Accept"
                                                            press="onApproveRequest"
                                                            visible="{= ${notificationModel>category} === 'workflow' && ${notificationModel>requiresApproval} === true}"
                                                            class="approveButton"/>
                                                        
                                                        <Button 
                                                            text="Reject"
                                                            icon="sap-icon://decline"
                                                            type="Reject"
                                                            press="onRejectRequest"
                                                            visible="{= ${notificationModel>category} === 'workflow' && ${notificationModel>requiresApproval} === true}"
                                                            class="rejectButton"/>
                                                        
                                                        <!-- Standard Actions -->
                                                        <Button 
                                                            icon="{= ${notificationModel>status} === 'unread' ? 'sap-icon://accept' : 'sap-icon://email-read'}"
                                                            type="Transparent"
                                                            tooltip="{= ${notificationModel>status} === 'unread' ? 'Mark as Read' : 'Already Read'}"
                                                            press="onToggleReadStatus"
                                                            enabled="{= ${notificationModel>status} === 'unread'}"/>
                                                        
                                                        <Button 
                                                            icon="sap-icon://bookmark"
                                                            type="Transparent"
                                                            tooltip="Bookmark"
                                                            press="onBookmark"/>
                                                        
                                                        <Button 
                                                            icon="sap-icon://delete"
                                                            type="Transparent"
                                                            tooltip="Delete"
                                                            press="onDelete"/>
                                                    </HBox>
                                                </HBox>
                                            </HBox>
                                            
                                            <!-- Enhanced Message Display -->
                                            <VBox class="messageContent sapUiSmallMarginTop">
                                                
                                                <!-- A2A Message Content -->
                                                <Panel 
                                                    visible="{= ${notificationModel>category} === 'agent_message'}"
                                                    class="a2aMessagePanel"
                                                    headerText="A2A Message Content"
                                                    expandable="true"
                                                    expanded="false">
                                                    <content>
                                                        <core:Fragment fragmentName="a2a.network.view.fragment.A2AMessageDisplay" type="XML"/>
                                                    </content>
                                                </Panel>
                                                
                                                <!-- Regular Message -->
                                                <FormattedText 
                                                    htmlText="{path: 'notificationModel>message', formatter: '.formatMessageContent'}"
                                                    class="messageText"
                                                    visible="{= ${notificationModel>category} !== 'agent_message'}"/>
                                                
                                                <!-- Metadata Tags -->
                                                <HBox wrap="Wrap" class="metadataTags sapUiSmallMarginTop">
                                                    <core:Fragment fragmentName="a2a.network.view.fragment.NotificationMetadata" type="XML"/>
                                                </HBox>
                                                
                                                <!-- Progress Indicator for Ongoing Tasks -->
                                                <ProgressIndicator 
                                                    percentValue="{notificationModel>progress}"
                                                    displayValue="{notificationModel>progressText}"
                                                    visible="{= ${notificationModel>hasProgress} === true}"
                                                    class="progressIndicator sapUiSmallMarginTop"/>
                                                
                                            </VBox>
                                            
                                        </VBox>
                                    </content>
                                </CustomListItem>
                                
                            </List>
                            
                        </VBox>
                    </l:SplitPane>
                </l:PaneContainer>
                
            </l:Splitter>
        </content>

        <!-- Footer with Real-time Status -->
        <footer>
            <Toolbar>
                <HBox alignItems="Center">
                    <core:Icon src="sap-icon://status-in-process" color="Accent8" class="sapUiTinyMarginEnd"/>
                    <Text text="Real-time A2A Event Stream Active"/>
                </HBox>
                <ToolbarSpacer/>
                <Text text="Last updated: {notificationModel>/lastUpdated}" class="lastUpdateFooter"/>
                <Text text="•" class="separator"/>
                <Text text="Events processed: {notificationModel>/totalEventsProcessed}"/>
            </Toolbar>
        </footer>
    </Page>
</mvc:View>