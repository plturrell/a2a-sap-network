<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.uxap">
    
    <Dialog
        title="Agent Details"
        contentWidth="90%"
        maxWidth="35rem"
        contentHeight="600px"
        class="a2a-tablet-dialog"
        resizable="true">
        
        <content>
            <f:ObjectPageLayout>
                <f:headerTitle>
                    <f:ObjectPageHeader
                        objectTitle="{agentDetail>/name}"
                        objectSubtitle="{agentDetail>/id}"
                        showMarkers="false">
                        
                        <f:actions>
                            <Button
                                text="{= ${agentDetail>/isActive} ? 'Deactivate' : 'Activate'}"
                                type="{= ${agentDetail>/isActive} ? 'Reject' : 'Success'}"
                                icon="{= ${agentDetail>/isActive} ? 'sap-icon://stop' : 'sap-icon://activate'}"
                                press=".onToggleAgentStatus" />
                            <Button
                                text="Send Message"
                                icon="sap-icon://email"
                                press=".onSendMessage" />
                        </f:actions>
                        
                        <f:objectAttributes>
                            <f:ObjectPageAttribute title="Owner" text="{agentDetail>/owner}" />
                            <f:ObjectPageAttribute title="Endpoint" text="{agentDetail>/endpoint}" />
                            <f:ObjectPageAttribute title="Registered" text="{
                                path: 'agentDetail>/registrationDate',
                                formatter: '.formatDateTime'
                            }" />
                        </f:objectAttributes>
                    </f:ObjectPageHeader>
                </f:headerTitle>
                
                <f:sections>
                    <f:ObjectPageSection title="Overview">
                        <f:subSections>
                            <f:ObjectPageSubSection>
                                <f:blocks>
                                    <VBox class="sapUiSmallMargin">
                                        <Label text="Description:" />
                                        <Text text="{agentDetail>/description}" />
                                        
                                        <HBox class="sapUiSmallMarginTop">
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Status:" />
                                                <ObjectStatus
                                                    text="{= ${agentDetail>/isActive} ? 'Active' : 'Inactive'}"
                                                    state="{= ${agentDetail>/isActive} ? 'Success' : 'Warning'}" />
                                            </VBox>
                                            
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Total Messages:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/messageCount}"
                                                    emphasized="true" />
                                            </VBox>
                                            
                                            <VBox>
                                                <Label text="Last Active:" />
                                                <Text text="{
                                                    path: 'agentDetail>/lastActive',
                                                    formatter: '.formatDateTime'
                                                }" />
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </f:blocks>
                            </f:ObjectPageSubSection>
                        </f:subSections>
                    </f:ObjectPageSection>
                    
                    <f:ObjectPageSection title="Reputation">
                        <f:subSections>
                            <f:ObjectPageSubSection>
                                <f:blocks>
                                    <VBox class="sapUiSmallMargin">
                                        <HBox>
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Reputation Score:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/score}"
                                                    state="Success"
                                                    emphasized="true" />
                                            </VBox>
                                            
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Rank:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/rank}"
                                                    unit="th" />
                                            </VBox>
                                            
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Total Tasks:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/totalTasks}" />
                                            </VBox>
                                            
                                            <VBox>
                                                <Label text="Success Rate:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/successRate}"
                                                    unit="%"
                                                    state="{= ${agentDetail>/reputation/successRate} > 90 ? 'Success' : 'Warning'}" />
                                            </VBox>
                                        </HBox>
                                        
                                        <HBox class="sapUiSmallMarginTop">
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Avg Response Time:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/avgResponseTime}"
                                                    unit="ms" />
                                            </VBox>
                                            
                                            <VBox>
                                                <Label text="Total Earnings:" />
                                                <ObjectNumber
                                                    number="{agentDetail>/reputation/totalEarnings}"
                                                    unit="A2A" />
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </f:blocks>
                            </f:ObjectPageSubSection>
                        </f:subSections>
                    </f:ObjectPageSection>
                    
                    <f:ObjectPageSection title="Performance Metrics">
                        <f:subSections>
                            <f:ObjectPageSubSection>
                                <f:blocks>
                                    <VBox class="sapUiSmallMargin">
                                        <HBox>
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Quality:" />
                                                <ProgressIndicator
                                                    percentValue="{agentDetail>/performance/quality}"
                                                    displayValue="{agentDetail>/performance/quality}%"
                                                    state="Success" />
                                            </VBox>
                                            
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Speed:" />
                                                <ProgressIndicator
                                                    percentValue="{agentDetail>/performance/speed}"
                                                    displayValue="{agentDetail>/performance/speed}%"
                                                    state="Success" />
                                            </VBox>
                                        </HBox>
                                        
                                        <HBox class="sapUiSmallMarginTop">
                                            <VBox class="sapUiSmallMarginEnd">
                                                <Label text="Reliability:" />
                                                <ProgressIndicator
                                                    percentValue="{agentDetail>/performance/reliability}"
                                                    displayValue="{agentDetail>/performance/reliability}%"
                                                    state="Success" />
                                            </VBox>
                                            
                                            <VBox>
                                                <Label text="Innovation:" />
                                                <ProgressIndicator
                                                    percentValue="{agentDetail>/performance/innovation}"
                                                    displayValue="{agentDetail>/performance/innovation}%"
                                                    state="Success" />
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </f:blocks>
                            </f:ObjectPageSubSection>
                        </f:subSections>
                    </f:ObjectPageSection>
                    
                    <f:ObjectPageSection title="Capabilities & Skills">
                        <f:subSections>
                            <f:ObjectPageSubSection>
                                <f:blocks>
                                    <VBox class="sapUiSmallMargin">
                                        <Label text="Capabilities:" />
                                        <HBox wrap="Wrap">
                                            <Token 
                                                text="{capability}"
                                                class="sapUiTinyMarginEnd">
                                                <customData>
                                                    <core:repeat list="{agentDetail>/capabilities}" var="capability">
                                                        <Token text="{capability}" />
                                                    </core:repeat>
                                                </customData>
                                            </Token>
                                        </HBox>
                                        
                                        <Label text="Skills:" class="sapUiSmallMarginTop" />
                                        <HBox wrap="Wrap">
                                            <Token 
                                                text="{skill}"
                                                class="sapUiTinyMarginEnd">
                                                <customData>
                                                    <core:repeat list="{agentDetail>/skills}" var="skill">
                                                        <Token text="{skill}" />
                                                    </core:repeat>
                                                </customData>
                                            </Token>
                                        </HBox>
                                    </VBox>
                                </f:blocks>
                            </f:ObjectPageSubSection>
                        </f:subSections>
                    </f:ObjectPageSection>
                </f:sections>
            </f:ObjectPageLayout>
        </content>
        
        <endButton>
            <Button
                text="Close"
                press=".onCloseAgentDetail" />
        </endButton>
    </Dialog>
</core:FragmentDefinition>