<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core">
    
    <ResponsivePopover
        title="AI Suggestions"
        placement="Bottom"
        contentWidth="400px"
        contentHeight="300px"
        showHeader="true"
        resizable="true">
        
        <content>
            <VBox class="sapUiSmallMargin">
                
                <!-- Suggestions Header -->
                <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                    <core:Icon src="sap-icon://lightbulb" color="#007bff" class="sapUiTinyMarginEnd"/>
                    <Text text="Smart Suggestions" class="sapMTextColorDefault"/>
                    <ToolbarSpacer/>
                    <Text text="{= ${view>/suggestions/currentSuggestions}.length + ' suggestions' }" 
                          class="sapUiTinyText sapMTextColorSecondary"/>
                </HBox>
                
                <!-- Suggestions List -->
                <List
                    items="{view>/suggestions/currentSuggestions}"
                    mode="None"
                    class="sapUiSizeCompact a2a-suggestions-list">
                    
                    <CustomListItem class="sapUiSmallMarginBottom">
                        <VBox>
                            <!-- Suggestion Header -->
                            <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                                <core:Icon src="{view>icon}" 
                                          color="{= ${view>type} === 'validation' ? '#dc3545' : 
                                                   ${view>type} === 'optimization' ? '#28a745' : 
                                                   '#007bff' }" 
                                          class="sapUiTinyMarginEnd"/>
                                <Text text="{view>title}" 
                                      class="sapMTextColorDefault sapMTextBold"/>
                                <ToolbarSpacer/>
                                <Text text="{= Math.round(${view>confidence} * 100) + '%' }" 
                                      class="sapUiTinyText sapMTextColorSecondary"/>
                            </HBox>
                            
                            <!-- Suggestion Description -->
                            <Text text="{view>description}" 
                                  wrapping="true"
                                  maxLines="2"
                                  class="sapUiTinyText sapMTextColorSecondary sapUiSmallMarginBottom"/>
                            
                            <!-- Action Buttons -->
                            <HBox alignItems="Center" justifyContent="End">
                                <Button 
                                    text="{= ${view>action} === 'replace' ? 'Replace' :
                                            ${view>action} === 'append' ? 'Append' :
                                            ${view>action} === 'insert' ? 'Insert' :
                                            ${view>action} === 'modify' ? 'Modify' : 'Apply' }"
                                    icon="sap-icon://accept" 
                                    type="Accept"
                                    press="onAcceptSuggestion"
                                    visible="{= ${view>action} !== 'info' }"
                                    tooltip="{= ${view>action} === 'replace' ? 'Replace current field value' :
                                               ${view>action} === 'append' ? 'Add to end of current value' :
                                               ${view>action} === 'insert' ? 'Insert at cursor position' :
                                               ${view>action} === 'modify' ? 'Modify using pattern replacement' : 'Apply suggestion' }"
                                    class="sapUiTinyMarginEnd"/>
                                <Button 
                                    text="Preview"
                                    icon="sap-icon://show" 
                                    type="Default"
                                    press="onPreviewSuggestion"
                                    visible="{= ${view>action} !== 'info' && ${view>previewable} === true }"
                                    class="sapUiTinyMarginEnd"/>
                                <Button 
                                    text="Got it"
                                    icon="sap-icon://message-success" 
                                    type="Default"
                                    press="onRejectSuggestion"
                                    visible="{= ${view>action} === 'info' }"
                                    class="sapUiTinyMarginEnd"/>
                                <Button 
                                    text="Dismiss"
                                    icon="sap-icon://decline" 
                                    type="Reject"
                                    press="onRejectSuggestion"/>
                            </HBox>
                        </VBox>
                    </CustomListItem>
                </List>
                
                <!-- Empty State -->
                <VBox alignItems="Center" 
                      visible="{= ${view>/suggestions/currentSuggestions}.length === 0 }"
                      class="sapUiMediumMarginTop">
                    <core:Icon src="sap-icon://lightbulb" size="2rem" color="#c0c0c0"/>
                    <Text text="No suggestions available" class="sapMTextColorSecondary"/>
                </VBox>
                
            </VBox>
        </content>
        
        <footer>
            <Toolbar>
                <ToolbarSpacer/>
                <Text text="Powered by AI Learning" class="sapUiTinyText sapMTextColorSecondary"/>
                <Button 
                    text="Close" 
                    icon="sap-icon://decline"
                    type="Default"
                    press="onCloseSuggestions"/>
            </Toolbar>
        </footer>
    </ResponsivePopover>
</core:FragmentDefinition>