<mvc:View
    controllerName="a2a.portal.controller.ProjectDetail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:l="sap.ui.layout"
    xmlns:core="sap.ui.core">
    
    <f:DynamicPage id="projectDetailPage" 
                   class="a2a-tablet-page"
                   headerExpanded="true" 
                   showFooter="false">
        
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="{/name}" level="H2"/>
                </f:heading>
                <f:breadcrumbs>
                    <Breadcrumbs>
                        <Link text="{i18n>navProjects}" press="onNavBack"/>
                    </Breadcrumbs>
                </f:breadcrumbs>
                <f:actions>
                    <Button text="{i18n>save}" 
                           type="Emphasized" 
                           icon="sap-icon://save" 
                           press="onSaveProject"
                           tooltip="{i18n>saveProjectTooltip}"/>
                    <Button text="{i18n>build}" 
                           icon="sap-icon://developer-settings" 
                           press="onBuildProject"
                           tooltip="{i18n>buildProjectTooltip}"/>
                    <Button text="{i18n>run}" 
                           icon="sap-icon://media-play" 
                           press="onRunProject"
                           tooltip="{i18n>runProjectTooltip}"/>
                    <Button text="{i18n>edit}" 
                           icon="sap-icon://edit" 
                           press="onEditProject"/>
                    <Button text="{i18n>deploy}" 
                           icon="sap-icon://upload-to-cloud" 
                           press="onDeployProject"/>
                    <Button icon="sap-icon://action" 
                           tooltip="{i18n>moreActions}"
                           press="onMoreActions"/>
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>

        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <l:VerticalLayout>
                    <ObjectAttribute title="{i18n>projectId}" text="{/project_id}"/>
                    <ObjectAttribute title="{i18n>created}" text="{path: '/created', formatter: '.formatDate'}"/>
                    <ObjectAttribute title="{i18n>lastModified}" text="{path: '/last_modified', formatter: '.formatDate'}"/>
                    <ObjectStatus title="{i18n>status}" 
                                text="{/status}" 
                                state="{path: '/status', formatter: '.formatStatusState'}"/>
                </l:VerticalLayout>
            </f:DynamicPageHeader>
        </f:header>

        <f:content>
            <IconTabBar id="projectTabBar" 
                       select="onTabSelect"
                       class="sapUiNoContentPadding">
                
                <items>
                    <!-- Overview Tab -->
                    <IconTabFilter text="{i18n>overview}" 
                                  icon="sap-icon://hint"
                                  key="overview">
                        <Panel headerText="{i18n>projectDescription}" 
                               class="sapUiMediumMargin">
                            <Text text="{/description}"/>
                        </Panel>
                        
                        <Panel headerText="{i18n>projectStatistics}" 
                               class="sapUiMediumMargin">
                            <l:Grid defaultSpan="L6 M12 S12">
                                <VBox class="sapUiMediumMargin">
                                    <Title text="{= ${/agents}.length }" level="H1"/>
                                    <Text text="{i18n>totalAgents}"/>
                                </VBox>
                                <VBox class="sapUiMediumMargin">
                                    <Title text="{= ${/workflows}.length }" level="H1"/>
                                    <Text text="{i18n>totalWorkflows}"/>
                                </VBox>
                            </l:Grid>
                        </Panel>
                    </IconTabFilter>
                    
                    <!-- Agents Tab -->
                    <IconTabFilter text="{i18n>agents}" 
                                  icon="sap-icon://collaborate"
                                  key="agents">
                        <Table items="{/agents}"
                               class="sapUiMediumMargin">
                            <headerToolbar>
                                <Toolbar>
                                    <Title text="{i18n>agentsList}"/>
                                    <ToolbarSpacer/>
                                    <Button text="{i18n>createAgent}" 
                                           icon="sap-icon://add" 
                                           press="onCreateAgent"/>
                                </Toolbar>
                            </headerToolbar>
                            <columns>
                                <Column><Text text="{i18n>agentName}"/></Column>
                                <Column><Text text="{i18n>agentType}"/></Column>
                                <Column><Text text="{i18n>status}"/></Column>
                                <Column><Text text="{i18n>actions}"/></Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Text text="{name}"/>
                                        <Text text="{type}"/>
                                        <ObjectStatus text="{status}" 
                                                    state="{path: 'status', formatter: '.formatStatusState'}"/>
                                        <HBox>
                                            <Button icon="sap-icon://edit" 
                                                   type="Transparent"
                                                   press="onEditAgent"/>
                                            <Button icon="sap-icon://delete" 
                                                   type="Transparent"
                                                   press="onDeleteAgent"/>
                                        </HBox>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </IconTabFilter>
                    
                    <!-- Workflows Tab -->
                    <IconTabFilter text="{i18n>workflows}" 
                                  icon="sap-icon://process"
                                  key="workflows">
                        <Table items="{/workflows}"
                               class="sapUiMediumMargin">
                            <headerToolbar>
                                <Toolbar>
                                    <Title text="{i18n>workflowsList}"/>
                                    <ToolbarSpacer/>
                                    <Button text="{i18n>createWorkflow}" 
                                           icon="sap-icon://add" 
                                           press="onCreateWorkflow"/>
                                </Toolbar>
                            </headerToolbar>
                            <columns>
                                <Column><Text text="{i18n>workflowName}"/></Column>
                                <Column><Text text="{i18n>workflowType}"/></Column>
                                <Column><Text text="{i18n>status}"/></Column>
                                <Column><Text text="{i18n>actions}"/></Column>
                            </columns>
                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <Text text="{name}"/>
                                        <Text text="{type}"/>
                                        <ObjectStatus text="{status}" 
                                                    state="{path: 'status', formatter: '.formatStatusState'}"/>
                                        <HBox>
                                            <Button icon="sap-icon://edit" 
                                                   type="Transparent"
                                                   press="onEditWorkflow"/>
                                            <Button icon="sap-icon://play" 
                                                   type="Transparent"
                                                   press="onRunWorkflow"/>
                                        </HBox>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </IconTabFilter>
                    
                    <!-- Files Tab -->
                    <IconTabFilter text="{i18n>files}" 
                                  icon="sap-icon://folder"
                                  key="files">
                        <VBox class="sapUiMediumMargin">
                            <Panel headerText="{i18n>projectFiles}" 
                                   class="sapUiNoContentPadding">
                                <headerToolbar>
                                    <Toolbar>
                                        <Title text="{i18n>fileExplorer}"/>
                                        <ToolbarSpacer/>
                                        <Button text="{i18n>createFile}" 
                                               icon="sap-icon://document" 
                                               press="onCreateFile"
                                               tooltip="{i18n>createFileTooltip}"/>
                                        <Button text="{i18n>createFolder}" 
                                               icon="sap-icon://folder-blank" 
                                               press="onCreateFolder"
                                               tooltip="{i18n>createFolderTooltip}"/>
                                        <Button icon="sap-icon://upload" 
                                               tooltip="{i18n>uploadFilesTooltip}"
                                               press="onUploadFiles"/>
                                        <Button icon="sap-icon://refresh" 
                                               tooltip="{i18n>refreshFilesTreeTooltip}"
                                               press="onRefreshFileTree"/>
                                    </Toolbar>
                                </headerToolbar>
                                <content>
                                    <!-- File Tree Structure -->
                                    <Tree id="fileExplorerTree"
                                          items="{path: '/files', 
                                                  templateShareable: false}"
                                          mode="MultiSelect"
                                          includeItemInSelection="true"
                                          toggleOpenState="onToggleFolder"
                                          itemPress="onFilePress"
                                          selectionChange="onFileSelectionChange"
                                          class="a2a-file-explorer">
                                        <StandardTreeItem title="{name}"
                                                        icon="{path: 'type', formatter: '.getFileIcon'}"
                                                        type="{path: 'type', formatter: '.getFileItemType'}"
                                                        press="onTreeItemPress"
                                                        class="a2a-file-tree-item"
                                                        customData="{
                                                            path: '',
                                                            templateShareable: false
                                                        }">
                                            <!-- Context Menu Trigger -->
                                            <customData>
                                                <core:CustomData key="filePath" value="{path}"/>
                                                <core:CustomData key="fileType" value="{type}"/>
                                                <core:CustomData key="fileName" value="{name}"/>
                                            </customData>
                                        </StandardTreeItem>
                                    </Tree>
                                </content>
                            </Panel>
                            
                            <!-- File Actions Panel -->
                            <Panel headerText="{i18n>selectedFileActions}" 
                                   visible="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length > 0 }"
                                   class="sapUiMediumMarginTop">
                                <Toolbar>
                                    <Text text="{= ${files>/selectedFiles} ? ${files>/selectedFiles}.length : 0 } {i18n>filesSelected}"/>
                                    <ToolbarSpacer/>
                                    <Button text="{i18n>open}" 
                                           icon="sap-icon://open-folder" 
                                           press="onOpenSelectedFile"
                                           enabled="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length === 1 }"/>
                                    <Button text="{i18n>rename}" 
                                           icon="sap-icon://edit" 
                                           press="onRenameFile"
                                           enabled="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length === 1 }"/>
                                    <Button text="{i18n>copy}" 
                                           icon="sap-icon://copy" 
                                           press="onCopyFiles"
                                           enabled="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length > 0 }"/>
                                    <Button text="{i18n>move}" 
                                           icon="sap-icon://move" 
                                           press="onMoveFiles"
                                           enabled="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length > 0 }"/>
                                    <Button text="{i18n>delete}" 
                                           icon="sap-icon://delete" 
                                           type="Transparent"
                                           press="onDeleteFiles"
                                           enabled="{= ${files>/selectedFiles} && ${files>/selectedFiles}.length > 0 }"/>
                                </Toolbar>
                            </Panel>
                        </VBox>
                    </IconTabFilter>
                    
                    <!-- Settings Tab -->
                    <IconTabFilter text="{i18n>settings}" 
                                  icon="sap-icon://action-settings"
                                  key="settings">
                        <l:VerticalLayout class="sapUiMediumMargin">
                            <Panel headerText="{i18n>generalSettings}">
                                <f:SimpleForm editable="true">
                                    <Label text="{i18n>projectName}"/>
                                    <Input value="{/name}"/>
                                    <Label text="{i18n>description}"/>
                                    <TextArea value="{/description}" rows="4"/>
                                </f:SimpleForm>
                            </Panel>
                            
                            <Panel headerText="{i18n>deploymentSettings}" 
                                   class="sapUiMediumMarginTop">
                                <f:SimpleForm editable="true">
                                    <Label text="{i18n>targetEnvironment}"/>
                                    <Select selectedKey="{/deployment/environment}">
                                        <items>
                                            <core:Item key="dev" text="{i18n>development}"/>
                                            <core:Item key="staging" text="{i18n>staging}"/>
                                            <core:Item key="prod" text="{i18n>production}"/>
                                        </items>
                                    </Select>
                                    <Label text="{i18n>autoDeployEnabled}"/>
                                    <Switch state="{/deployment/autoDeploy}"/>
                                </f:SimpleForm>
                            </Panel>
                        </l:VerticalLayout>
                    </IconTabFilter>
                    
                    <!-- Terminal Tab -->
                    <IconTabFilter text="{i18n>terminal}" 
                                  icon="sap-icon://command-line-interfaces"
                                  key="terminal">
                        <VBox class="sapUiNoContentPadding" height="100%">
                            <Toolbar>
                                <Title text="{i18n>projectTerminal}"/>
                                <ToolbarSpacer/>
                                <Button text="{i18n>newTerminal}" 
                                       icon="sap-icon://add" 
                                       press="onNewTerminal"
                                       tooltip="{i18n>createNewTerminalSession}"/>
                                <MenuButton text="{i18n>terminal}" icon="sap-icon://menu2">
                                    <menu>
                                        <Menu>
                                            <MenuItem text="{i18n>clearTerminal}" 
                                                     icon="sap-icon://clear-all"
                                                     press="onClearTerminal"/>
                                            <MenuItem text="{i18n>exportOutput}" 
                                                     icon="sap-icon://download"
                                                     press="onExportTerminalOutput"/>
                                            <MenuItem text="{i18n>terminalSettings}" 
                                                     icon="sap-icon://settings"
                                                     press="onTerminalSettings"/>
                                        </Menu>
                                    </menu>
                                </MenuButton>
                            </Toolbar>
                            
                            <!-- Terminal Container -->
                            <ScrollContainer id="terminalContainer"
                                           height="600px"
                                           width="100%"
                                           vertical="true"
                                           horizontal="false"
                                           class="a2a-terminal-container">
                                <VBox id="terminalContent" class="a2a-terminal-content">
                                    <!-- Terminal sessions will be added here dynamically -->
                                </VBox>
                            </ScrollContainer>
                            
                            <!-- Command Input -->
                            <Toolbar class="a2a-terminal-input-toolbar">
                                <Label text="$" class="a2a-terminal-prompt"/>
                                <Input id="terminalCommandInput"
                                      value="{terminal>/currentCommand}"
                                      placeholder="{i18n>enterCommand}"
                                      submit="onTerminalCommandSubmit"
                                      width="100%"
                                      class="a2a-terminal-input"/>
                                <Button icon="sap-icon://play" 
                                       press="onTerminalCommandSubmit"
                                       tooltip="{i18n>executeCommand}"/>
                            </Toolbar>
                        </VBox>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </f:content>
    </f:DynamicPage>
</mvc:View>