<mvc:View
    controllerName="com.sap.a2a.portal.controller.ProjectsList"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:macros="sap.fe.macros"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
    height="100%">
    
    <!-- SAP Fiori Elements List Report Page -->
    <f:DynamicPage id="projectsListPage" class="a2a-tablet-page sapUiContentPadding">
        
        <!-- Dynamic Page Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="{i18n>projects.title}" level="H1"/>
                </f:heading>
                <f:snappedHeading>
                    <Title text="{i18n>projects.title}" level="H3"/>
                </f:snappedHeading>
                <f:expandedContent>
                    <MessageStrip
                        text="{i18n>projects.welcome.message}"
                        type="Information"
                        showIcon="true"
                        class="sapUiSmallMarginBottom"/>
                </f:expandedContent>
                <f:actions>
                    <Button
                        id="createProjectBtn"
                        text="{i18n>btn.create}"
                        type="Emphasized"
                        icon="sap-icon://add"
                        press="onCreateProject"
                        tooltip="{i18n>projects.create}"/>
                    <Button
                        id="importProjectBtn"
                        text="{i18n>btn.import}"
                        icon="sap-icon://upload"
                        press="onImportProject"
                        tooltip="{i18n>projects.import}"/>
                    <OverflowToolbarMenuButton
                        id="moreActionsBtn"
                        icon="sap-icon://overflow"
                        tooltip="{i18n>btn.more.actions}">
                        <menu>
                            <Menu>
                                <MenuItem
                                    text="{i18n>btn.export}"
                                    icon="sap-icon://excel-attachment"
                                    press="onExportToExcel"/>
                                <MenuItem
                                    text="{i18n>projects.template.create}"
                                    icon="sap-icon://create-form"
                                    press="onCreateTemplate"/>
                                <MenuItem
                                    text="{i18n>settings.table}"
                                    icon="sap-icon://action-settings"
                                    press="onTableSettings"/>
                            </Menu>
                        </menu>
                    </OverflowToolbarMenuButton>
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>
        
        <!-- Dynamic Page Header (Filter Bar) -->
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <!-- SAP Fiori Elements Filter Bar Macro -->
                <macros:FilterBar
                    id="projectsFilterBar"
                    metaPath="@com.sap.vocabularies.UI.v1.SelectionFields"
                    contextPath="/Projects"
                    search="onFilterSearch"
                    filterChanged="onFilterChanged"
                    showAdaptFiltersButton="true"
                    showFilterConfiguration="true"
                    showSearchField="true"
                    searchPlaceholder="{i18n>projects.search.placeholder}">
                    
                    <!-- Custom Filter Fields -->
                    <macros:filterFields>
                        <!-- Status Filter -->
                        <macros:FilterField
                            key="status"
                            label="{i18n>form.status}"
                            conditions="{$filters>/conditions/status}">
                            <macros:control>
                                <MultiComboBox
                                    id="statusFilterFE"
                                    placeholder="{i18n>projects.filter.status}"
                                    selectedKeys="{$filters>/conditions/status}"
                                    items="{
                                        path: '/ProjectStatuses',
                                        sorter: {path: 'text'}
                                    }">
                                    <core:Item key="{key}" text="{text}"/>
                                </MultiComboBox>
                            </macros:control>
                        </macros:FilterField>
                        
                        <!-- Owner Filter -->
                        <macros:FilterField
                            key="owner"
                            label="{i18n>form.owner}"
                            conditions="{$filters>/conditions/owner}">
                            <macros:control>
                                <ComboBox
                                    id="ownerFilterFE"
                                    placeholder="{i18n>projects.filter.owner}"
                                    selectedKey="{$filters>/conditions/owner}"
                                    items="{/ProjectOwners}">
                                    <core:Item key="{key}" text="{text}"/>
                                </ComboBox>
                            </macros:control>
                        </macros:FilterField>
                        
                        <!-- Date Range Filter -->
                        <macros:FilterField
                            key="dateRange"
                            label="{i18n>projects.filter.date.range}"
                            conditions="{$filters>/conditions/dateRange}">
                            <macros:control>
                                <DateRangeSelection
                                    id="dateRangeFilterFE"
                                    placeholder="{i18n>projects.filter.date.placeholder}"
                                    value="{$filters>/conditions/dateRange}"/>
                            </macros:control>
                        </macros:FilterField>
                    </macros:filterFields>
                </macros:FilterBar>
            </f:DynamicPageHeader>
        </f:header>
        
        <!-- Dynamic Page Content (Table) -->
        <f:content>
            <VBox class="sapUiMediumMargin">
                <!-- Projects Table using Fiori Elements Table Macro -->
                <macros:Table
                    id="projectsTableFE"
                    contextPath="/Projects"
                    metaPath="@com.sap.vocabularies.UI.v1.LineItem"
                    readOnly="false"
                    enableExport="true"
                    enablePaste="false"
                    threshold="50"
                    selectionMode="Multi"
                    type="ResponsiveTable"
                    personalization="Sort,Filter,Column"
                    header="{i18n>projects.list}"
                    headerLevel="H2">
                    
                    <!-- Custom Column Actions -->
                    <macros:actions>
                        <macros:Action
                            key="edit"
                            text="{i18n>btn.edit}"
                            press="onEditProject"
                            requiresSelection="true"
                            icon="sap-icon://edit"/>
                        <macros:Action
                            key="duplicate"
                            text="{i18n>btn.duplicate}"
                            press="onDuplicateProject"
                            requiresSelection="true"
                            icon="sap-icon://duplicate"/>
                        <macros:Action
                            key="delete"
                            text="{i18n>btn.delete}"
                            press="onDeleteProject"
                            requiresSelection="true"
                            icon="sap-icon://delete"
                            criticality="Negative"/>
                    </macros:actions>
                    
                    <!-- Custom Columns Definition -->
                    <macros:columns>
                        <!-- Project Name Column -->
                        <macros:Column
                            key="name"
                            header="{i18n>form.name}"
                            dataProperty="name"
                            importance="High"
                            width="auto">
                            <macros:template>
                                <Link
                                    text="{name}"
                                    press="onProjectPress"
                                    emphasized="true"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Description Column -->
                        <macros:Column
                            key="description"
                            header="{i18n>form.description}"
                            dataProperty="description"
                            importance="Medium"
                            width="auto">
                            <macros:template>
                                <Text
                                    text="{description}"
                                    maxLines="2"
                                    tooltip="{description}"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Status Column with Criticality -->
                        <macros:Column
                            key="status"
                            header="{i18n>form.status}"
                            dataProperty="status"
                            importance="High"
                            width="7rem">
                            <macros:template>
                                <ObjectStatus
                                    text="{status}"
                                    state="{
                                        path: 'status',
                                        formatter: '.formatter.statusState'
                                    }"
                                    icon="{
                                        path: 'status',
                                        formatter: '.formatter.statusIcon'
                                    }"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Priority Column -->
                        <macros:Column
                            key="priority"
                            header="{i18n>form.priority}"
                            dataProperty="priority"
                            importance="Medium"
                            width="6rem">
                            <macros:template>
                                <ObjectStatus
                                    text="{priority}"
                                    state="{
                                        path: 'priority',
                                        formatter: '.formatter.priorityState'
                                    }"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Assigned Agents Column -->
                        <macros:Column
                            key="agents"
                            header="{i18n>projects.assignedAgents}"
                            dataProperty="agentCount"
                            importance="Low"
                            width="8rem">
                            <macros:template>
                                <HBox alignItems="Center">
                                    <core:Icon
                                        src="sap-icon://group"
                                        class="sapUiTinyMarginEnd"
                                        color="Neutral"/>
                                    <Text text="{agentCount}"/>
                                </HBox>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Progress Column -->
                        <macros:Column
                            key="progress"
                            header="{i18n>projects.progress}"
                            dataProperty="progressPercent"
                            importance="Medium"
                            width="8rem">
                            <macros:template>
                                <ProgressIndicator
                                    percentValue="{progressPercent}"
                                    displayValue="{progressPercent}%"
                                    state="{
                                        path: 'progressPercent',
                                        formatter: '.formatter.progressState'
                                    }"
                                    width="100%"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Created Date Column -->
                        <macros:Column
                            key="createdDate"
                            header="{i18n>projects.createdDate}"
                            dataProperty="createdAt"
                            importance="Low"
                            width="9rem">
                            <macros:template>
                                <Text text="{
                                    path: 'createdAt',
                                    type: 'sap.ui.model.odata.type.DateTimeOffset',
                                    formatOptions: {
                                        style: 'short'
                                    }
                                }"/>
                            </macros:template>
                        </macros:Column>
                        
                        <!-- Last Modified Column -->
                        <macros:Column
                            key="lastModified"
                            header="{i18n>projects.lastModified}"
                            dataProperty="lastModified"
                            importance="Low"
                            width="9rem">
                            <macros:template>
                                <Text text="{
                                    path: 'lastModified',
                                    type: 'sap.ui.model.odata.type.DateTimeOffset',
                                    formatOptions: {
                                        relative: true,
                                        relativeScale: 'auto'
                                    }
                                }"/>
                            </macros:template>
                        </macros:Column>
                    </macros:columns>
                    
                    <!-- Row Actions -->
                    <macros:rowActions>
                        <macros:RowAction
                            icon="sap-icon://detail-view"
                            text="{i18n>btn.view}"
                            press="onViewProject"/>
                    </macros:rowActions>
                </macros:Table>
                
                <!-- No Data Display -->
                <core:Fragment fragmentName="com.sap.a2a.portal.fragment.NoDataDisplay" type="XML"/>
            </VBox>
        </f:content>
        
        <!-- Floating Footer with Summary Info -->
        <f:footer>
            <OverflowToolbar>
                <ToolbarSpacer/>
                <Label text="{
                    parts: ['/Projects/length', 'i18n>projects.count.total'],
                    formatter: '.formatter.formatProjectCount'
                }"/>
                <ToolbarSeparator/>
                <Label text="{
                    parts: ['projectsTableFE>/selectedContexts/length', 'i18n>projects.count.selected'],
                    formatter: '.formatter.formatSelectedCount'
                }" visible="{= ${projectsTableFE>/selectedContexts/length} > 0}"/>
            </OverflowToolbar>
        </f:footer>
    </f:DynamicPage>
</mvc:View>